# ============================================================================
# Directus S3 Storage Configuration Template (Story 5.1)
# ============================================================================
#
# This file contains the S3 storage configuration that will be used to migrate
# Directus from local volume storage to SeaweedFS S3-compatible storage.
#
# CURRENT STATE (Story 4.1):
#   - File storage: Local volume (borgstack_directus_uploads)
#   - Configuration: STORAGE_LOCATIONS=local
#
# FUTURE STATE (Story 5.1):
#   - File storage: SeaweedFS S3-compatible distributed storage
#   - Configuration: Environment variables below
#
# DO NOT USE THIS FILE YET - It is a template for Story 5.1 implementation.
#
# ============================================================================

# ============================================================================
# S3 Storage Driver Configuration
# ============================================================================

# Storage location identifier
# Change from "local" to "seaweedfs" when migrating to S3
STORAGE_LOCATIONS=seaweedfs

# S3 driver specification
STORAGE_SEAWEEDFS_DRIVER=s3

# SeaweedFS S3 endpoint (internal Docker DNS)
# SeaweedFS S3 API runs on port 8333
STORAGE_SEAWEEDFS_ENDPOINT=http://seaweedfs:8333

# S3 bucket name (shared across all BorgStack services)
# All services use the "borgstack" bucket with different prefixes
STORAGE_SEAWEEDFS_BUCKET=borgstack

# S3 object key prefix (namespace for Directus files within bucket)
# All Directus files will be stored under /borgstack/directus/ path
STORAGE_SEAWEEDFS_ROOT=directus/

# S3 region (required by S3 API, but not used by SeaweedFS)
# Set to "us-east-1" as default (SeaweedFS ignores this value)
STORAGE_SEAWEEDFS_REGION=us-east-1

# ============================================================================
# S3 Authentication Credentials
# ============================================================================

# S3 access key (from .env variable)
# Generated during SeaweedFS setup in Story 5.1
# Format: 20-character alphanumeric string
STORAGE_SEAWEEDFS_KEY=${SEAWEEDFS_S3_ACCESS_KEY}

# S3 secret key (from .env variable)
# Generated during SeaweedFS setup in Story 5.1
# Format: 40-character alphanumeric string
STORAGE_SEAWEEDFS_SECRET=${SEAWEEDFS_S3_SECRET_KEY}

# ============================================================================
# S3 Advanced Configuration (Optional)
# ============================================================================

# Force path-style URLs (required for SeaweedFS)
# Path-style: http://seaweedfs:8333/borgstack/directus/file.jpg
# Virtual-hosted-style: http://borgstack.seaweedfs:8333/directus/file.jpg
# SeaweedFS uses path-style URLs by default
STORAGE_SEAWEEDFS_FORCE_PATH_STYLE=true

# Custom S3 ACL (Access Control List)
# Options: private, public-read, public-read-write, authenticated-read
# Default: private (files only accessible via signed URLs)
STORAGE_SEAWEEDFS_ACL=private

# ============================================================================
# Migration Notes
# ============================================================================
#
# When Story 5.1 is complete and SeaweedFS is deployed:
#
# 1. Stop Directus container:
#    docker compose stop directus
#
# 2. Migrate existing files from local volume to SeaweedFS:
#    ./scripts/migrate-directus-to-s3.sh
#
# 3. Update docker-compose.yml to add these environment variables:
#    - Copy all STORAGE_SEAWEEDFS_* variables above
#    - Change STORAGE_LOCATIONS from "local" to "seaweedfs"
#    - Remove borgstack_directus_uploads volume mount (keep volume for backup)
#
# 4. Start Directus container:
#    docker compose up -d directus
#
# 5. Verify S3 storage is working:
#    - Login to Directus admin UI
#    - Upload a test file
#    - Check SeaweedFS for the file: docker compose exec seaweedfs weed shell
#      > fs.ls /borgstack/directus/
#
# 6. Monitor logs for any S3 connection errors:
#    docker compose logs -f directus | grep -i "storage"
#
# ============================================================================
# Troubleshooting S3 Storage Issues
# ============================================================================
#
# Issue: "Access Denied" errors when uploading files
# Solution:
#   - Verify SEAWEEDFS_S3_ACCESS_KEY and SEAWEEDFS_S3_SECRET_KEY match in .env
#   - Check SeaweedFS S3 permissions: weed s3 user list
#   - Ensure borgstack bucket exists: weed s3 bucket list
#
# Issue: Files upload but don't appear in Directus
# Solution:
#   - Verify STORAGE_SEAWEEDFS_BUCKET is set to "borgstack"
#   - Check STORAGE_SEAWEEDFS_ROOT is set to "directus/" (with trailing slash)
#   - Verify Directus can read from S3: docker compose logs directus | grep -i "s3"
#
# Issue: Slow file uploads/downloads
# Solution:
#   - Verify SeaweedFS is on borgstack_internal network
#   - Check network connectivity: docker compose exec directus ping seaweedfs
#   - Monitor SeaweedFS performance: docker compose logs seaweedfs | grep -i "slow"
#
# Issue: Migration script fails
# Solution:
#   - Ensure local volume still exists: docker volume ls | grep directus_uploads
#   - Verify SeaweedFS is healthy: docker compose ps seaweedfs
#   - Check migration script logs: cat /var/log/borgstack-migration.log
#
# ============================================================================
# Expected S3 Bucket Structure (After Story 5.1)
# ============================================================================
#
# /borgstack/                         # Root S3 bucket
#   ├── directus/                     # Directus namespace (STORAGE_SEAWEEDFS_ROOT)
#   │   ├── originals/                # Original uploaded files
#   │   │   ├── {uuid}.jpg
#   │   │   ├── {uuid}.png
#   │   │   └── {uuid}.pdf
#   │   ├── thumbnails/               # Auto-generated thumbnails
#   │   │   ├── {uuid}_200x200.jpg
#   │   │   └── {uuid}_400x400.jpg
#   │   └── documents/                # Document assets
#   │       ├── {uuid}.docx
#   │       └── {uuid}.xlsx
#   ├── fileflows/                    # FileFlows namespace (other services)
#   └── duplicati/                    # Duplicati namespace (backups)
#
# ============================================================================

# ============================================================================
# Additional Resources
# ============================================================================
#
# Directus S3 Storage Documentation:
#   https://docs.directus.io/self-hosted/config-options.html#file-storage
#
# SeaweedFS S3 API Documentation:
#   https://github.com/seaweedfs/seaweedfs/wiki/Amazon-S3-API
#
# BorgStack Story 5.1 (SeaweedFS Deployment):
#   docs/stories/5.1.seaweedfs-object-storage.md
#
# Migration Script (to be created in Story 5.1):
#   scripts/migrate-directus-to-s3.sh
#
# ============================================================================
