# Lowcoder Configuration Guide

Lowcoder is a low-code application platform for building custom internal business applications with drag-and-drop UI builder, data source connections, and workflow integration.

## Table of Contents

1. [First-Time Setup](#first-time-setup)
2. [Admin Account Login](#admin-account-login)
3. [Basic Application Creation](#basic-application-creation)
4. [Data Source Connection Setup](#data-source-connection-setup)
5. [User Management and Permissions](#user-management-and-permissions)
6. [Application Templates](#application-templates)
7. [Integration with n8n](#integration-with-n8n)
8. [Troubleshooting](#troubleshooting)

---

## First-Time Setup

### Prerequisites

Before accessing Lowcoder, ensure:

1. **DNS Configuration**: `lowcoder.{DOMAIN}` DNS A record points to your server IP
2. **SSL Certificate**: Caddy automatically provisions Let's Encrypt SSL on first access
3. **Services Running**: Verify Lowcoder container is healthy

```bash
# Verify DNS resolution
dig lowcoder.example.com.br +short

# Check Lowcoder container status
docker compose ps lowcoder

# View Lowcoder logs (check for startup errors)
docker compose logs lowcoder

# Verify health check
docker compose exec lowcoder curl -f http://localhost:3000/api/health
```

### Access Lowcoder Web UI

1. **Navigate to**: `https://lowcoder.{DOMAIN}`
2. **First access**: SSL certificate generation may take 30-60 seconds
3. **Expected**: Lowcoder login page with "Sign in" and "Sign up" options

---

## Admin Account Login

### Initial Admin Account

The admin account is created automatically on first startup using environment variables from `.env`:

- **Email**: `LOWCODER_ADMIN_EMAIL` (default: `admin@{DOMAIN}`)
- **Password**: `LOWCODER_ADMIN_PASSWORD` (32-char auto-generated by bootstrap script)

### First Login Steps

1. **Open Lowcoder**: `https://lowcoder.{DOMAIN}`
2. **Click "Sign in"**
3. **Enter credentials**:
   - Email: Value from `.env` file (`LOWCODER_ADMIN_EMAIL`)
   - Password: Value from `.env` file (`LOWCODER_ADMIN_PASSWORD`)
4. **Click "Sign in"**

**IMPORTANT**: Retrieve credentials from `.env` file:

```bash
# View admin credentials
grep LOWCODER_ADMIN .env
```

### Change Admin Password (Recommended)

1. **Login** to Lowcoder
2. **Click profile icon** (top-right corner)
3. **Select "Settings"**
4. **Navigate to "Account" tab**
5. **Change password** to a memorable password
6. **Save changes**

⚠️ **CRITICAL**: Update `.env` file with new password to prevent confusion during container restarts.

---

## Basic Application Creation

### Creating Your First Application

1. **Login** to Lowcoder admin UI
2. **Click "Create New"** button (top-right)
3. **Select "Application"**
4. **Choose template** (or start with "Blank App")
5. **Name your application** (e.g., "Customer Dashboard")
6. **Click "Create"**

### Application Builder Interface

**Main Components**:

- **Canvas** (center): Drag-and-drop UI design area
- **Component Panel** (left): Pre-built UI components (tables, forms, buttons, charts)
- **Inspector Panel** (right): Component properties and data binding
- **Query Panel** (bottom): Data source queries and API calls

### Building a Simple CRUD Application

**Example: Customer List with PostgreSQL**

1. **Add Data Source** (see [Data Source Connection Setup](#data-source-connection-setup))
2. **Create Query**:
   - Click **"+ New Query"** in Query Panel
   - Select PostgreSQL data source (e.g., `chatwoot_db`)
   - Write SQL query: `SELECT * FROM contacts LIMIT 100`
   - Click **"Run"** to test query
   - Name query: `get_customers`

3. **Add Table Component**:
   - Drag **"Table"** component from Component Panel to Canvas
   - In Inspector Panel, bind data: `{{ get_customers.data }}`
   - Table automatically displays customer data

4. **Add Create Button**:
   - Drag **"Button"** component to Canvas
   - Set button text: "Add Customer"
   - Create click event: Open modal or navigate to form page

5. **Deploy Application**:
   - Click **"Publish"** (top-right)
   - Application is now live and accessible to users

---

## Data Source Connection Setup

Lowcoder supports multiple data sources: PostgreSQL, REST APIs, GraphQL, MongoDB, and more.

### Connecting to PostgreSQL (BorgStack Databases)

**⚠️ SECURITY: Use Read-Only User for Lowcoder Applications**

For security best practices, Lowcoder applications should use a **read-only database user** (`lowcoder_readonly_user`) instead of service owner accounts. This implements the principle of least privilege by granting SELECT-only permissions.

#### Step 1: Create Read-Only Database User

Before configuring datasources in Lowcoder, create the read-only user by executing the SQL script:

```bash
# Copy SQL script to PostgreSQL container
docker compose cp config/postgresql/create-lowcoder-readonly-users.sql postgresql:/tmp/

# Execute script with password from .env
docker compose exec postgresql psql -U postgres \
  -v LOWCODER_READONLY_DB_PASSWORD="$(grep LOWCODER_READONLY_DB_PASSWORD .env | cut -d= -f2)" \
  -f /tmp/create-lowcoder-readonly-users.sql
```

**Verify User Creation**:

```bash
# List database users (should show lowcoder_readonly_user)
docker compose exec postgresql psql -U postgres -c "\du"

# Verify read-only permissions on n8n_db
docker compose exec postgresql psql -U postgres -d n8n_db \
  -c "SELECT grantee, privilege_type FROM information_schema.role_table_grants WHERE grantee = 'lowcoder_readonly_user';"
```

#### Step 2: Configure PostgreSQL Datasource in Lowcoder UI

**Example: Connect to Chatwoot Database (Read-Only)**

1. **Navigate to "Data Sources"** (left sidebar in Lowcoder UI)
2. **Click "+ New Data Source"**
3. **Select "PostgreSQL"**
4. **Configure connection**:
   - **Name**: `chatwoot_db_readonly` (descriptive name indicating read-only access)
   - **Host**: `postgresql` (Docker service name on borgstack_internal network)
   - **Port**: `5432`
   - **Database**: `chatwoot_db`
   - **Username**: `lowcoder_readonly_user`
   - **Password**: Retrieve from `.env` file (`LOWCODER_READONLY_DB_PASSWORD`)
   - **SSL Mode**: `disable` (internal network, SSL not required)

5. **Test Connection**: Click "Test Connection" button (should show "Connection successful")
6. **Save**: Click "Save" to store data source

**Connection String Format** (for reference):
```
postgresql://lowcoder_readonly_user:${LOWCODER_READONLY_DB_PASSWORD}@postgresql:5432/chatwoot_db
```

#### Available PostgreSQL Databases for Lowcoder Applications

| Database | Read-Only User | Purpose | Example Use Cases |
|----------|---------------|---------|------------------|
| `n8n_db` | `lowcoder_readonly_user` | n8n workflow data | Workflow execution dashboard, automation analytics |
| `chatwoot_db` | `lowcoder_readonly_user` | Customer service conversations | Agent performance metrics, conversation history viewer |
| `evolution_db` | `lowcoder_readonly_user` | WhatsApp message history | Message analytics, WhatsApp campaign reporting |
| `directus_db` | `lowcoder_readonly_user` | CMS content data | Content analytics, collection statistics |

**Retrieve Read-Only Password**:

```bash
# View read-only database password
grep LOWCODER_READONLY_DB_PASSWORD .env
```

#### Security Considerations for PostgreSQL Datasources

**✅ DO:**
- **Use `lowcoder_readonly_user`** for query-only applications (dashboards, reports, analytics)
- **Use parameterized queries** in Lowcoder query builder to prevent SQL injection
- **Validate user inputs** before using in SQL queries
- **Grant minimal permissions** - read-only user has SELECT only, no INSERT/UPDATE/DELETE
- **Store credentials securely** - Lowcoder encrypts datasource passwords using `LOWCODER_ENCRYPTION_PASSWORD`

**❌ DON'T:**
- **Never use service owner accounts** (`n8n_user`, `chatwoot_user`, etc.) in Lowcoder datasources
- **Never hardcode passwords** in application queries or components
- **Avoid string concatenation** for SQL queries (use parameterized queries instead)
- **Don't expose sensitive data** in public applications without access control

#### Example Datasource Configurations

**1. n8n Workflow Analytics Datasource**

- **Name**: `n8n_db_readonly`
- **Host**: `postgresql`
- **Port**: `5432`
- **Database**: `n8n_db`
- **Username**: `lowcoder_readonly_user`
- **Password**: `${LOWCODER_READONLY_DB_PASSWORD}` (from .env)

**Example Query**: `SELECT * FROM execution_entity WHERE finished = true ORDER BY "startedAt" DESC LIMIT 100`

**2. Chatwoot Customer Service Datasource**

- **Name**: `chatwoot_db_readonly`
- **Host**: `postgresql`
- **Port**: `5432`
- **Database**: `chatwoot_db`
- **Username**: `lowcoder_readonly_user`
- **Password**: `${LOWCODER_READONLY_DB_PASSWORD}` (from .env)

**Example Query**: `SELECT * FROM conversations WHERE status = 'open' ORDER BY created_at DESC`

**3. Evolution API WhatsApp History Datasource**

- **Name**: `evolution_db_readonly`
- **Host**: `postgresql`
- **Port**: `5432`
- **Database**: `evolution_db`
- **Username**: `lowcoder_readonly_user`
- **Password**: `${LOWCODER_READONLY_DB_PASSWORD}` (from .env)

**Example Query**: `SELECT * FROM "Message" WHERE "key_fromMe" = false ORDER BY "messageTimestamp" DESC LIMIT 50`

**4. Directus CMS Content Datasource**

- **Name**: `directus_db_readonly`
- **Host**: `postgresql`
- **Port**: `5432`
- **Database**: `directus_db`
- **Username**: `lowcoder_readonly_user`
- **Password**: `${LOWCODER_READONLY_DB_PASSWORD}` (from .env)

**Example Query**: `SELECT * FROM directus_collections ORDER BY collection ASC`

#### Alternative: Using Service Owner Accounts (NOT RECOMMENDED)

For applications that require write access (INSERT/UPDATE/DELETE), you can use service owner accounts, but this is **NOT RECOMMENDED** for security reasons.

**If you must use service owner accounts:**

1. **Create dedicated application user** with minimal required permissions (e.g., `lowcoder_writer_user`)
2. **Grant specific permissions** only (e.g., INSERT on specific tables, not all tables)
3. **Audit all write operations** and log changes
4. **Implement application-level access control** in Lowcoder

**Example: Service Owner Account (NOT RECOMMENDED)**

- **Username**: `chatwoot_user` (service owner account)
- **Password**: `${CHATWOOT_DB_PASSWORD}` (from .env)
- **Permissions**: Full read/write access to chatwoot_db

⚠️ **WARNING**: Using service owner accounts in Lowcoder applications violates the principle of least privilege and increases security risk.

### Connecting to REST API (Evolution API Example)

1. **Navigate to "Data Sources"**
2. **Click "+ New Data Source"**
3. **Select "REST API"**
4. **Configure connection**:
   - **Name**: `evolution_api`
   - **Base URL**: `https://evolution.{DOMAIN}`
   - **Headers**:
     - `apikey`: Retrieve from `.env` file (`EVOLUTION_API_KEY`)
     - `Content-Type`: `application/json`

5. **Test API Call**:
   - Create query: `GET /instance/fetchInstances`
   - Click "Run" to verify API access

6. **Save Data Source**

### Connecting to n8n Webhooks

Lowcoder can trigger n8n workflows via webhook calls.

1. **Create webhook in n8n** (see [Integration with n8n](#integration-with-n8n))
2. **In Lowcoder, create REST API data source**:
   - **Name**: `n8n_webhooks`
   - **Base URL**: `https://n8n.{DOMAIN}/webhook`

3. **Create Query in Application**:
   - **Method**: `POST`
   - **URL**: `/lowcoder-trigger` (webhook path)
   - **Body**: `{{ { "data": tableComponent.selectedRow } }}`

4. **Trigger from Button**: Button click event → Run query

---

## User Management and Permissions

### Creating Additional Users

1. **Login as Admin**
2. **Navigate to "Settings"** (profile icon → Settings)
3. **Select "Users" tab**
4. **Click "+ Invite User"**
5. **Enter user email** (e.g., `developer@example.com.br`)
6. **Select role**:
   - **Admin**: Full access to all applications and settings
   - **Developer**: Can create and edit applications
   - **Viewer**: Read-only access to published applications

7. **Send invitation** (user receives email with signup link)

### User Roles and Permissions

| Role | Create Apps | Edit Apps | Manage Users | View Published Apps |
|------|-------------|-----------|--------------|---------------------|
| **Admin** | ✅ | ✅ | ✅ | ✅ |
| **Developer** | ✅ | ✅ (own apps) | ❌ | ✅ |
| **Viewer** | ❌ | ❌ | ❌ | ✅ |

### Application-Level Permissions

1. **Open application** in editor
2. **Click "Share"** button (top-right)
3. **Add users or groups**:
   - **Owner**: Full control (can delete)
   - **Editor**: Can modify application
   - **Viewer**: Read-only access

4. **Public Access**:
   - Toggle "Public Access" to share with all users
   - Generate shareable link for external access (requires authentication)

---

## Security Best Practices

### Security Checklist for Application Developers

Use this checklist when building Lowcoder applications to ensure security best practices:

**Data Source Security:**
- [ ] Use `lowcoder_readonly_user` for read-only applications (dashboards, reports)
- [ ] Never use service owner accounts (`n8n_user`, `chatwoot_user`, etc.) unless absolutely required
- [ ] Store all datasource passwords in Lowcoder (encrypted with `LOWCODER_ENCRYPTION_PASSWORD`)
- [ ] Never hardcode credentials in application code or queries
- [ ] Verify datasource connections use internal network (`postgresql:5432`, not external IPs)

**Query Security:**
- [ ] Use parameterized queries (NOT string concatenation) to prevent SQL injection
- [ ] Validate all user inputs before using in queries
- [ ] Limit query results (use `LIMIT` clause) to prevent performance issues
- [ ] Avoid `SELECT *` - explicitly list required columns
- [ ] Test queries with malicious input (e.g., `'; DROP TABLE users; --`)

**Application Access Control:**
- [ ] Set appropriate application permissions (Owner, Editor, Viewer)
- [ ] Disable "Public Access" unless required for external users
- [ ] Use role-based access control (RBAC) for sensitive applications
- [ ] Review user list regularly and remove inactive users
- [ ] Require authentication for all applications (no anonymous access)

**Data Protection:**
- [ ] Mask sensitive data (passwords, credit cards, PII) in UI components
- [ ] Filter out sensitive columns in queries (don't expose to frontend)
- [ ] Implement data retention policies (auto-delete old records)
- [ ] Use HTTPS for all API calls (n8n webhooks, Evolution API, etc.)
- [ ] Encrypt sensitive data at rest (use PostgreSQL pgcrypto extension)

**Audit and Monitoring:**
- [ ] Enable Lowcoder audit logs (Settings → Audit Logs)
- [ ] Log all data modifications (INSERT/UPDATE/DELETE queries)
- [ ] Monitor failed login attempts
- [ ] Review application access logs monthly
- [ ] Set up alerts for suspicious activities (abnormal query patterns)

**Deployment Security:**
- [ ] Change admin password after first login
- [ ] Rotate `LOWCODER_ENCRYPTION_PASSWORD` and `LOWCODER_ENCRYPTION_SALT` annually
- [ ] Backup datasource credentials securely (password manager)
- [ ] Test applications in staging environment before production deployment
- [ ] Document security assumptions and threat models

### Principle of Least Privilege

**Database Access:**

Always grant **minimum required permissions** to Lowcoder datasources:

1. **Read-Only Applications** (dashboards, reports, analytics):
   - ✅ Use `lowcoder_readonly_user` (SELECT only)
   - ❌ Don't use service owner accounts with full access

2. **Write Applications** (forms, data entry):
   - ✅ Create dedicated user with INSERT/UPDATE permissions on specific tables only
   - ❌ Don't grant DELETE or TRUNCATE permissions unless required

3. **Admin Applications** (user management, system config):
   - ✅ Create separate admin user with full permissions
   - ✅ Restrict access to admin users only (not all Lowcoder users)
   - ❌ Don't use PostgreSQL superuser (`postgres`) in Lowcoder

**Example: Creating Write-Enabled User (Minimal Permissions)**

```sql
-- Create user for form submissions (INSERT only)
CREATE USER lowcoder_form_writer WITH ENCRYPTED PASSWORD 'secure_password_here';

-- Grant connection to specific database
GRANT CONNECT ON DATABASE chatwoot_db TO lowcoder_form_writer;

-- Grant INSERT permission on specific table only
\c chatwoot_db
GRANT USAGE ON SCHEMA public TO lowcoder_form_writer;
GRANT INSERT ON contacts TO lowcoder_form_writer;

-- Verify permissions (should show INSERT only)
SELECT grantee, privilege_type FROM information_schema.role_table_grants
WHERE grantee = 'lowcoder_form_writer';
```

### Secure Credential Storage

**Lowcoder Credential Encryption:**

All datasource credentials in Lowcoder are encrypted using `LOWCODER_ENCRYPTION_PASSWORD` and `LOWCODER_ENCRYPTION_SALT` environment variables.

**Best Practices:**

1. **Strong Encryption Keys:**
   ```bash
   # Generate strong encryption keys (32 characters)
   openssl rand -base64 32 | tr -d "=+/" | cut -c1-32
   ```

2. **Backup Encryption Keys:**
   - Store `LOWCODER_ENCRYPTION_PASSWORD` in password manager
   - Store `LOWCODER_ENCRYPTION_SALT` in password manager
   - Without these keys, all datasource credentials become inaccessible

3. **Key Rotation (Annual):**
   ```bash
   # 1. Export all datasource configurations (manual backup)
   # 2. Generate new encryption keys
   # 3. Update .env with new keys
   # 4. Restart Lowcoder: docker compose restart lowcoder
   # 5. Re-enter all datasource passwords in Lowcoder UI
   ```

4. **Never Commit Credentials:**
   - ✅ `.env` file is in `.gitignore`
   - ❌ Never commit datasource passwords to git
   - ❌ Never share encryption keys via email/chat

### SQL Injection Prevention

**Vulnerable Code (DON'T DO THIS):**

```sql
-- ❌ DANGEROUS: String concatenation allows SQL injection
SELECT * FROM users WHERE email = '{{ textInput1.value }}'
```

**Attack Example:**
- User input: `admin@example.com' OR '1'='1`
- Executed query: `SELECT * FROM users WHERE email = 'admin@example.com' OR '1'='1'`
- Result: Returns ALL users (security breach)

**Secure Code (USE THIS):**

```sql
-- ✅ SAFE: Parameterized query (Lowcoder handles escaping)
SELECT * FROM users WHERE email = {{ textInput1.value }}
```

**Query Builder Best Practices:**

1. **Use Lowcoder Variables:** `{{ componentName.value }}` (automatically escaped)
2. **Validate Inputs:** Use component validation (email format, regex patterns)
3. **Whitelist Values:** Use dropdown/select components instead of free text
4. **Escape Special Characters:** If string concatenation is unavoidable, use PostgreSQL `quote_literal()` function

**Input Validation Example:**

```javascript
// In Lowcoder component validation
// Email input validation
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
return emailRegex.test(emailInput.value) || "Invalid email format";

// Numeric input validation
const userId = parseInt(userIdInput.value);
return !isNaN(userId) && userId > 0 || "Invalid user ID";
```

### User Permission Management

**Lowcoder User Roles:**

| Role | Permissions | Use Case |
|------|-------------|----------|
| **Admin** | Full access: Create/edit/delete apps, manage users, system settings | System administrators, IT team |
| **Developer** | Create/edit own apps, view all apps | Application developers, power users |
| **Viewer** | View published apps only, no editing | End users, business users |

**Application-Level Permissions:**

1. **Private Application** (default):
   - Only creator and explicitly granted users can access
   - Recommended for sensitive data applications

2. **Shared Application**:
   - Share with specific users or groups
   - Owner: Full control (can delete app)
   - Editor: Can modify application code
   - Viewer: Read-only access to published version

3. **Public Application**:
   - All authenticated Lowcoder users can access
   - ⚠️ WARNING: Don't use for sensitive data

**Best Practices:**

- Review user permissions quarterly
- Remove users who left the organization immediately
- Use principle of least privilege (grant minimum required role)
- Document application owners and maintainers

### Audit Logging and Monitoring

**Enable Audit Logs:**

1. **Login as Admin**
2. **Navigate to Settings → Audit Logs**
3. **Enable Audit Logging**
4. **Configure log retention** (default: 90 days)

**What Gets Logged:**

- User login/logout events
- Application creation/modification/deletion
- Datasource configuration changes
- Query executions (optional, enable for sensitive apps)
- Permission changes
- Failed authentication attempts

**Monitoring Best Practices:**

1. **Regular Log Reviews:**
   ```bash
   # Export audit logs monthly
   # Review for suspicious activities:
   # - Failed login attempts (potential brute force)
   # - Unusual query patterns (potential data exfiltration)
   # - Permission escalations (unauthorized access)
   ```

2. **Set Up Alerts:**
   - Failed login > 5 times in 1 hour → Alert admin
   - Datasource configuration change → Email notification
   - Application deletion → Approval required

3. **Database Query Logging:**
   ```bash
   # Enable PostgreSQL query logging for forensics
   docker compose exec postgresql psql -U postgres -c \
     "ALTER SYSTEM SET log_statement = 'all';"
   docker compose restart postgresql

   # View query logs
   docker compose logs postgresql | grep "LOG:  statement"
   ```

4. **Integration with n8n for Monitoring:**
   - Create n8n workflow: Monitor Lowcoder audit logs
   - Send alerts to Slack/Teams when suspicious activity detected
   - Example: Daily summary of application access patterns

---

## Application Templates

### CRUD Application Template

**Use Case**: Customer management with create, read, update, delete operations

**Components**:
- Table component (list view)
- Form component (create/edit)
- Modal component (delete confirmation)
- Buttons (actions)

**Data Source**: PostgreSQL database

**Example**: Customer list from Chatwoot `contacts` table

### Dashboard Template

**Use Case**: Real-time metrics and visualizations

**Components**:
- Chart components (line, bar, pie)
- Stat cards (KPIs)
- Filter components (date range, dropdown)
- Table component (detailed data)

**Data Source**: PostgreSQL database or REST API

**Example**: Chatwoot conversation metrics dashboard

### Form Template

**Use Case**: Data entry with validation and submission

**Components**:
- Input components (text, number, email, date)
- Select/dropdown components
- Checkbox/radio components
- Submit button

**Data Source**: PostgreSQL (insert query) or REST API (POST endpoint)

**Example**: New customer registration form

### Workflow Trigger Template

**Use Case**: Trigger n8n workflows from Lowcoder applications

**Components**:
- Button component (trigger action)
- REST API query (webhook call to n8n)
- Table component (display results)

**Data Source**: n8n webhook REST API

**Example**: Send WhatsApp message via Evolution API workflow

---

## Integration with n8n

Lowcoder integrates with n8n workflows through two patterns:

### Pattern 1: Webhook Trigger (Lowcoder → n8n)

**Use Case**: Button click in Lowcoder app triggers n8n workflow

**Setup**:

1. **Create n8n Workflow**:
   - Add **Webhook** node (trigger)
   - Set webhook path: `/lowcoder-trigger`
   - Add workflow logic (e.g., send WhatsApp message via Evolution API)

2. **Get Webhook URL**: `https://n8n.{DOMAIN}/webhook/lowcoder-trigger`

3. **In Lowcoder Application**:
   - Create **REST API** data source: `n8n_webhooks`
   - Create **Query**:
     - Method: `POST`
     - URL: `/lowcoder-trigger`
     - Body: `{{ { "customer_id": table1.selectedRow.id, "message": textInput1.value } }}`
   - Add **Button** component
   - Button click event: **Run query** → `webhook_trigger`

4. **Test**: Click button in Lowcoder → n8n workflow executes

### Pattern 2: API Query (Lowcoder → n8n API)

**Use Case**: Display workflow execution results in Lowcoder dashboard

**Setup**:

1. **Create n8n API Key** (in n8n Settings → API Keys)
2. **In Lowcoder**:
   - Create **REST API** data source:
     - Base URL: `https://n8n.{DOMAIN}/api/v1`
     - Headers: `X-N8N-API-KEY: <your-api-key>`
   - Create **Query**:
     - Method: `GET`
     - URL: `/executions`
   - Bind query data to **Table** component

3. **Display Results**: Table shows workflow execution history

---

## Troubleshooting

### 1. MongoDB Connection Failed

**Symptoms**: Lowcoder UI shows "Database connection error" or logs show MongoDB connection failures

**Solution**:

```bash
# Verify MongoDB is running and healthy
docker compose ps mongodb

# Check MongoDB logs
docker compose logs mongodb | tail -n 50

# Test MongoDB connection from Lowcoder container
docker compose exec lowcoder curl -f mongodb://lowcoder_user:${LOWCODER_DB_PASSWORD}@mongodb:27017/lowcoder?authSource=lowcoder

# Verify LOWCODER_MONGODB_URL in docker-compose.yml
docker compose config | grep LOWCODER_MONGODB_URL

# Verify LOWCODER_DB_PASSWORD in .env
grep LOWCODER_DB_PASSWORD .env

# Test MongoDB authentication manually
docker compose exec mongodb mongosh -u lowcoder_user -p "$(grep LOWCODER_DB_PASSWORD .env | cut -d= -f2)" --authenticationDatabase lowcoder lowcoder
```

**Common Causes**:
- MongoDB container not started: `docker compose up -d mongodb`
- Incorrect password in `.env`: Regenerate or fix `LOWCODER_DB_PASSWORD`
- MongoDB user not created: Check `config/mongodb/init-mongo.js` initialization script

---

### 2. Redis Connection Failed

**Symptoms**: Lowcoder UI slow or session management issues

**Solution**:

```bash
# Verify Redis is running
docker compose ps redis

# Check Redis logs
docker compose logs redis | tail -n 50

# Test Redis connection
docker compose exec redis redis-cli -a "$(grep REDIS_PASSWORD .env | cut -d= -f2)" PING

# Verify LOWCODER_REDIS_URL in docker-compose.yml
docker compose config | grep LOWCODER_REDIS_URL

# Restart Redis if needed
docker compose restart redis
```

**Common Causes**:
- Redis container not started: `docker compose up -d redis`
- Incorrect password in `.env`: Fix `REDIS_PASSWORD`

---

### 3. Admin Login Not Working

**Symptoms**: "Invalid credentials" error when logging in with admin account

**Solution**:

```bash
# Verify admin credentials in .env
grep LOWCODER_ADMIN .env

# Check Lowcoder logs for admin account creation
docker compose logs lowcoder | grep -i admin

# Restart Lowcoder to re-create admin account (if first startup failed)
docker compose restart lowcoder

# Wait for startup (60 seconds)
sleep 60

# Check logs again
docker compose logs lowcoder | grep -i "admin"
```

**Reset Admin Password via MongoDB** (if needed):

```bash
# Connect to MongoDB
docker compose exec mongodb mongosh -u admin -p "$(grep MONGODB_ROOT_PASSWORD .env | cut -d= -f2)" --authenticationDatabase admin

# Switch to lowcoder database
use lowcoder

# Find admin user
db.users.findOne({ email: "admin@example.com.br" })

# Reset password (requires bcrypt hash - use Lowcoder UI "Forgot Password" feature instead)
```

**Alternative**: Use "Forgot Password" feature on login page to reset admin password via email (requires SMTP configuration).

---

### 4. Application Not Saving

**Symptoms**: Application changes not persisting after page reload

**Solution**:

```bash
# Verify borgstack_lowcoder_stacks volume is mounted
docker compose config | grep -A5 "borgstack_lowcoder_stacks"

# Check volume permissions
docker compose exec lowcoder ls -la /lowcoder-stacks

# Check MongoDB connection (applications stored in MongoDB)
docker compose exec lowcoder curl -f http://localhost:3000/api/health

# View Lowcoder logs for save errors
docker compose logs lowcoder | grep -i "save\|error"

# Restart Lowcoder
docker compose restart lowcoder
```

**Common Causes**:
- Volume not mounted: Verify docker-compose.yml volume configuration
- MongoDB connection lost: Check MongoDB health
- Disk space full: Check `df -h`

---

### 5. Data Source Connection Failed

**Symptoms**: "Connection failed" error when testing PostgreSQL or API data sources

**PostgreSQL Connection Troubleshooting**:

```bash
# Verify PostgreSQL is running
docker compose ps postgresql

# Test PostgreSQL connection from Lowcoder container
docker compose exec lowcoder pg_isready -h postgresql -p 5432

# Verify database exists and user has permissions
docker compose exec postgresql psql -U postgres -c "\l"  # List databases
docker compose exec postgresql psql -U postgres -c "\du"  # List users

# Test specific database access
docker compose exec postgresql psql -U chatwoot_user -d chatwoot_db -c "SELECT 1"
```

**Ensure Lowcoder can reach PostgreSQL**:
- Both containers must be on `borgstack_internal` network
- Use hostname `postgresql` (Docker DNS)
- Verify user password from `.env` file

**Read-Only User Connection Troubleshooting**:

```bash
# Verify lowcoder_readonly_user exists
docker compose exec postgresql psql -U postgres -c "\du" | grep lowcoder_readonly

# Test read-only user connection to n8n_db
docker compose exec postgresql psql -U lowcoder_readonly_user -d n8n_db \
  -c "SELECT 1" 2>&1

# Check permissions on specific database
docker compose exec postgresql psql -U postgres -d chatwoot_db \
  -c "SELECT grantee, privilege_type FROM information_schema.role_table_grants WHERE grantee = 'lowcoder_readonly_user' LIMIT 10;"

# If user doesn't exist, re-run creation script
docker compose cp config/postgresql/create-lowcoder-readonly-users.sql postgresql:/tmp/
docker compose exec postgresql psql -U postgres \
  -v LOWCODER_READONLY_DB_PASSWORD="$(grep LOWCODER_READONLY_DB_PASSWORD .env | cut -d= -f2)" \
  -f /tmp/create-lowcoder-readonly-users.sql
```

**Common Read-Only User Issues**:
- User not created: Run `config/postgresql/create-lowcoder-readonly-users.sql` script
- Wrong password: Verify `LOWCODER_READONLY_DB_PASSWORD` in `.env` matches PostgreSQL user password
- No permissions on database: Re-run SQL script to grant permissions
- Tables created after user creation: Run `GRANT SELECT ON ALL TABLES IN SCHEMA public TO lowcoder_readonly_user;` on affected database

**REST API Connection Troubleshooting**:

```bash
# Test API from Lowcoder container
docker compose exec lowcoder curl -f https://evolution.example.com.br/instance/fetchInstances \
  -H "apikey: $(grep EVOLUTION_API_KEY .env | cut -d= -f2)"

# Check firewall rules (if external API)
curl -I https://external-api.example.com
```

---

### 6. Health Check Failing

**Symptoms**: Lowcoder container shows "unhealthy" status

**Solution**:

```bash
# Check health check command
docker compose config | grep -A10 "lowcoder:" | grep -A5 "healthcheck"

# Test health endpoint manually
docker compose exec lowcoder curl -f http://localhost:3000/api/health

# View Lowcoder startup logs
docker compose logs lowcoder | grep -i "started\|ready"

# Check if Spring Boot started
docker compose logs lowcoder | grep "Started"

# Check if Node.js service started
docker compose logs lowcoder | grep "Node service"

# If initialization takes longer, increase start_period in docker-compose.yml
# Current: start_period: 60s (Spring Boot + Node.js initialization)
```

**Common Causes**:
- Slow server: Increase `start_period` to 90s or 120s
- MongoDB/Redis not ready: Ensure dependencies start first
- Port 3000 conflict: Check if another service is using port 3000

---

### 7. SSL Certificate Not Issued

**Symptoms**: Browser shows "Your connection is not private" or SSL error

**Solution**:

```bash
# Verify DNS is configured
dig lowcoder.example.com.br +short

# Check Caddy logs for certificate issuance
docker compose logs caddy | grep -i "lowcoder\|certificate\|acme"

# Verify port 80 is accessible (ACME HTTP-01 challenge)
curl -I http://lowcoder.example.com.br

# Check Caddy configuration
docker compose exec caddy caddy validate --config /etc/caddy/Caddyfile

# Force certificate renewal (if stuck)
docker compose restart caddy
```

**Requirements for SSL**:
1. DNS A record: `lowcoder.{DOMAIN}` → Server IP
2. Port 80 open: Firewall allows HTTP (for ACME challenge)
3. Port 443 open: Firewall allows HTTPS
4. First access: Certificate generation takes 30-60 seconds

---

### 8. Performance Issues (Slow UI)

**Symptoms**: Lowcoder UI sluggish, slow query execution

**Solution**:

```bash
# Check container resource usage
docker stats lowcoder

# Check MongoDB performance
docker compose exec mongodb mongosh -u admin -p "$(grep MONGODB_ROOT_PASSWORD .env | cut -d= -f2)" --authenticationDatabase admin --eval "db.serverStatus()"

# Check Redis performance
docker compose exec redis redis-cli -a "$(grep REDIS_PASSWORD .env | cut -d= -f2)" INFO stats

# Restart Lowcoder to clear cache
docker compose restart lowcoder

# Check server resources (RAM, CPU)
htop
df -h
```

**Performance Tuning**:
- **MongoDB**: Add indexes to frequently queried fields
- **Redis**: Increase memory limit if needed (default: 8GB)
- **Lowcoder**: Increase container memory limit in docker-compose.yml

---

## Additional Resources

- **Official Documentation**: [https://docs.lowcoder.cloud](https://docs.lowcoder.cloud)
- **Community Forum**: [https://github.com/lowcoderorg/lowcoder/discussions](https://github.com/lowcoderorg/lowcoder/discussions)
- **Video Tutorials**: Search "Lowcoder tutorials" on YouTube

---

## Support

For BorgStack-specific issues:
- Check `docker compose logs lowcoder` for error messages
- Review this troubleshooting guide
- Verify `.env` configuration
- Ensure all dependencies (MongoDB, Redis) are healthy

For Lowcoder-specific questions:
- Official Lowcoder documentation
- GitHub Issues: [https://github.com/lowcoderorg/lowcoder/issues](https://github.com/lowcoderorg/lowcoder/issues)
