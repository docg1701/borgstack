# Story 1.1: Project Repository Structure (Epic 1 - Foundation & Core Infrastructure)

## Status
Done

## Story
**As a** developer,
**I want** a monorepo structure with proper directory organization and initial configuration files,
**so that** I can maintain consistency across all components and easily manage deployments.

## Acceptance Criteria
1. Repository created with standard monorepo structure
2. Root directory contains docker-compose.yml as centerpiece
3. Separate directories for configuration, documentation, and scripts
4. .gitignore file properly configured for Docker projects
5. .env.example template with all required variables
6. .gitignore configured to exclude .env files
7. README.md with project overview and quick start instructions
8. Initial version control setup with proper branching strategy

## Tasks / Subtasks
- [x] Create root directory structure (AC: 1, 3)
  - [x] Create `config/` directory for service-specific configurations
  - [x] Create `scripts/` directory for automation scripts
  - [x] Create `docs/` directory for Portuguese documentation
  - [x] Create `tests/` directory with `integration/` and `deployment/` subdirectories
- [x] Create docker-compose.yml placeholder (AC: 2)
  - [x] Add version specification (Docker Compose v2 format)
  - [x] Add placeholder networks section (borgstack_internal, borgstack_external)
  - [x] Add placeholder volumes section with borgstack_ prefix
  - [x] Add basic structure comments for future service additions
- [x] Create docker-compose.override.yml for local development (AC: 2)
  - [x] Add file header comments explaining purpose (local development overrides)
  - [x] Add example port mappings for local debugging
  - [x] Add example volume mounts for local development
- [x] Create docker-compose.prod.yml for production config (AC: 2)
  - [x] Add file header comments explaining purpose (production-specific settings)
  - [x] Add restart policies (restart: unless-stopped)
  - [x] Add resource limits placeholders (memory, CPU)
- [x] Configure version control files (AC: 4, 6, 8)
  - [x] Create .gitignore with Docker-specific exclusions (.env, volumes, logs)
  - [x] Ensure .env, .env.local, .env.*.local are in .gitignore
  - [x] Create .github/workflows/ci.yml with docker-compose config validation
  - [x] Document branching strategy in README.md Contributing section (feature/, fix/ branches)
- [x] Create environment variable template (AC: 5, 6)
  - [x] Create .env.example with all required variables organized by service
  - [x] Include PostgreSQL credentials placeholders
  - [x] Include Redis password placeholder
  - [x] Include MongoDB credentials placeholders
  - [x] Include domain/SSL configuration variables
  - [x] Add detailed comments for each variable group (purpose, example values, security warnings)
- [x] Create bilingual README.md (AC: 7)
  - [x] Add project overview section (EN/PT-BR)
  - [x] Add quick start instructions
  - [x] Add link to full documentation
  - [x] Add system requirements (Ubuntu 24.04, Docker Compose v2)
  - [x] Add license information
- [x] Create LICENSE file (AC: 1)
  - [x] Add MIT License (permissive open source license for infrastructure projects)
- [x] Verify structure alignment with architecture (AC: 1)
  - [x] Cross-reference created structure with docs/architecture/source-tree.md
  - [x] Ensure all top-level directories match architectural definition
  - [x] Verify naming conventions follow coding-standards.md

## Dev Notes

### Project Structure Requirements
This story establishes the foundational monorepo structure for BorgStack. The entire directory structure is defined in the architecture and must be created exactly as specified.

**Important Notes:**
- Bootstrap script (`scripts/bootstrap.sh`) implementation is deferred to **Story 1.6** - only create the placeholder directory structure in this story
- CI workflow file (`.github/workflows/ci.yml`) should contain actual docker-compose validation logic, not just placeholder
- Docker Compose files (override and prod) should have commented examples for their intended purpose

**Source Tree Reference**: [Source: architecture/source-tree.md]

The complete directory structure to create:
```
borgstack/
├── .github/
│   └── workflows/
│       └── ci.yml                    # CI validation (docker-compose config lint)
│
├── config/                           # Service-specific configuration files
│   ├── postgresql/
│   │   ├── init-databases.sql        # Database initialization script
│   │   └── postgresql.conf           # Performance tuning
│   ├── redis/
│   │   └── redis.conf                # Cache/queue configuration
│   ├── seaweedfs/
│   │   └── filer.toml                # Filer configuration
│   ├── caddy/
│   │   └── Caddyfile                 # Reverse proxy + SSL config
│   ├── n8n/
│   │   └── workflows/                # Example workflow templates
│   ├── chatwoot/
│   │   └── .env.example              # Chatwoot-specific vars
│   ├── evolution/
│   │   └── .env.example              # Evolution API config
│   └── duplicati/
│       └── backup-config.json        # Backup job definitions
│
├── scripts/
│   ├── bootstrap.sh                  # Ubuntu 24.04 automated setup
│   ├── healthcheck.sh                # Post-deployment verification
│   ├── backup-now.sh                 # Manual backup trigger
│   ├── restore.sh                    # Disaster recovery script
│   ├── update-service.sh             # Individual service update
│   └── generate-env.sh               # Interactive .env generator
│
├── docs/                             # Portuguese documentation
│   ├── prd.md                        # Product requirements (source)
│   ├── architecture.md               # This document
│   ├── 01-installation.md            # Guia de instalação
│   ├── 02-configuration.md           # Configuração inicial
│   ├── 03-services/                  # Service-specific guides
│   │   ├── n8n.md                    # Como usar n8n
│   │   ├── chatwoot.md               # Guia Chatwoot
│   │   ├── evolution-api.md          # Integração WhatsApp
│   │   ├── lowcoder.md               # Construir aplicativos
│   │   ├── directus.md               # CMS e gestão de dados
│   │   ├── fileflows.md              # Processamento de mídia
│   │   └── duplicati.md              # Backups e restauração
│   ├── 04-integrations/              # Integration tutorials
│   │   ├── whatsapp-chatwoot.md      # WhatsApp → Chatwoot via n8n
│   │   ├── directus-fileflows.md     # CMS → Media processing
│   │   └── backup-strategy.md        # Estratégia de backup
│   ├── 05-troubleshooting.md         # Solução de problemas
│   ├── 06-maintenance.md             # Manutenção e atualizações
│   ├── 07-security.md                # Hardening de segurança
│   └── 08-performance.md             # Otimização de desempenho
│
├── tests/
│   ├── integration/                  # Integration test scripts
│   │   ├── test-n8n-evolution.sh     # n8n → Evolution API
│   │   ├── test-chatwoot-api.sh      # Chatwoot API connectivity
│   │   └── test-backup-restore.sh    # Backup/restore validation
│   └── deployment/                   # Deployment validation
│       ├── check-dns.sh              # DNS configuration check
│       ├── check-resources.sh        # RAM/disk validation
│       └── verify-services.sh        # Health check all services
│
├── .env.example                      # Environment variable template
├── .gitignore                        # Exclude .env, volumes, logs
├── docker-compose.yml                # Main orchestration file
├── docker-compose.override.yml       # Local development overrides
├── docker-compose.prod.yml           # Production-specific config
├── LICENSE                           # Open source license
└── README.md                         # Quick start (bilingual EN/PT-BR)
```

### Technology Stack
[Source: architecture/tech-stack.md]

**Core Infrastructure**:
- **Docker Compose**: v2 (latest) - Container orchestration
- **Ubuntu Server LTS**: 24.04 - Host OS (deployment target)
- **Git**: Latest stable - Version control for configuration

**Important**: This is an infrastructure deployment project using pre-built Docker images, not custom application development.

### Naming Conventions
[Source: architecture/coding-standards.md]

**Critical conventions to follow**:

| Element | Convention | Example |
|---------|-----------|---------|
| **Docker Volumes** | `borgstack_<service>_<purpose>` | `borgstack_postgresql_data` |
| **Docker Networks** | `borgstack_<purpose>` | `borgstack_internal`, `borgstack_external` |
| **Environment Variables** | SCREAMING_SNAKE_CASE | `POSTGRES_PASSWORD`, `N8N_DB_PASSWORD` |
| **Shell Scripts** | kebab-case.sh | `bootstrap.sh`, `backup-now.sh` |
| **Documentation** | Numbered, kebab-case.md | `01-installation.md` |
| **Git Branches** | `feature/<name>`, `fix/<name>` | `feature/add-monitoring` |
| **Git Commits** | Imperative mood, lowercase | `add health checks to all services` |

### Git Configuration Requirements
[Source: architecture/coding-standards.md]

**.gitignore must include**:
```
# Environment files
.env
.env.local
.env.*.local

# Docker volumes and data
volumes/
data/

# Logs
*.log
logs/

# OS files
.DS_Store
Thumbs.db
```

**Branching strategy**:
- Main branch: `main` (protected)
- Feature branches: `feature/<descriptive-name>`
- Bug fix branches: `fix/<descriptive-name>`
- Use imperative mood for commits: "add", "fix", "update" (not "added", "fixed", "updated")

### Docker Compose Configuration Standards
[Source: architecture/coding-standards.md]

**Critical rules for docker-compose.yml**:
1. **Never use `latest` tag** - Always pin exact versions (e.g., `n8nio/n8n:1.112.6`)
2. **Network isolation** - Use `borgstack_internal` for service-to-service, `borgstack_external` for proxy
3. **Volume naming** - Prefix all volumes with `borgstack_`
4. **Configuration as Code** - Mount config files from repo, not from volumes
5. **Health checks required** - All long-running services must define health checks
6. **Dependency management** - Use `depends_on` with `condition: service_healthy`

### Environment Variables Template Structure
[Source: architecture/tech-stack.md]

The .env.example must include placeholders for all services:

**PostgreSQL** (shared database):
- POSTGRES_PASSWORD
- N8N_DB_PASSWORD
- CHATWOOT_DB_PASSWORD
- DIRECTUS_DB_PASSWORD
- EVOLUTION_DB_PASSWORD

**MongoDB** (Lowcoder only):
- MONGO_INITDB_ROOT_USERNAME
- MONGO_INITDB_ROOT_PASSWORD
- LOWCODER_MONGODB_URL

**Redis** (shared cache/queue):
- REDIS_PASSWORD

**Domain/SSL Configuration**:
- BORGSTACK_DOMAIN
- N8N_DOMAIN
- CHATWOOT_DOMAIN
- EVOLUTION_DOMAIN
- LOWCODER_DOMAIN
- DIRECTUS_DOMAIN
- FILEFLOWS_DOMAIN
- DUPLICATI_DOMAIN

### README.md Requirements
[Source: architecture/source-tree.md]

The README must be bilingual (EN/PT-BR) and include:
1. Project overview - What is BorgStack
2. Quick start instructions - Bootstrap script usage
3. System requirements - Ubuntu 24.04, 36GB RAM, 8 vCPU, Docker Compose v2
4. Link to full documentation in docs/
5. License information

### Testing Approach
[Source: architecture/testing-strategy.md]

**No unit tests required** - This is infrastructure deployment, not application development.

**Testing focus**:
- Configuration validation - Ensure docker-compose.yml syntax is valid
- Structure verification - Confirm all directories exist and match architecture
- Git setup verification - Ensure .gitignore works correctly

**Test validation commands**:
```bash
# Validate docker-compose.yml syntax
docker compose config --quiet

# Verify directory structure
ls -la config/ scripts/ docs/ tests/

# Check .gitignore effectiveness
git status --ignored
```

## Testing

### Testing Standards
[Source: architecture/testing-strategy.md]

**Testing Philosophy**:
- Focus on deployment validation, not unit tests
- Verify configuration correctness
- Ensure structure matches architectural definition

**Validation Requirements**:
1. Docker Compose configuration syntax validation
2. Directory structure verification against source-tree.md
3. Git ignore rules effectiveness check
4. README accessibility and clarity review

**Test Execution**:
```bash
# Configuration validation
docker compose config --quiet  # Must exit 0 with no errors

# Structure verification
ls -la config/ scripts/ docs/ tests/  # All directories must exist

# Git configuration check
git status --ignored  # .env files must be ignored
```

**Success Criteria**:
- All directories from source-tree.md exist
- docker-compose.yml passes validation
- .env.example contains all required variables
- .gitignore excludes .env files correctly
- README.md renders correctly with bilingual content

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-09-30 | 1.1 | Validation corrections: Added epic reference, docker-compose override/prod tasks, specified MIT License, clarified CI workflow and bootstrap deferral | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
No debug issues encountered during implementation.

### Completion Notes List
- Successfully created complete monorepo directory structure per source-tree.md
- All Docker Compose files validated successfully (main, override, prod)
- Fixed initial volumes section validation error in docker-compose.yml
- Comprehensive .env.example created with all service variables and security documentation
- Bilingual README.md (EN/PT-BR) created with complete project documentation
- MIT License added
- CI workflow implemented with comprehensive validation checks
- All acceptance criteria met and verified

### File List
**New Files:**
- `.github/workflows/ci.yml` - CI validation workflow with Docker Compose config checks
- `docker-compose.yml` - Main orchestration file with network definitions
- `docker-compose.override.yml` - Local development overrides with port mappings
- `docker-compose.prod.yml` - Production configuration with restart policies and resource limits
- `.env.example` - Comprehensive environment variable template
- `LICENSE` - MIT License (2025)

**Modified Files:**
- `.gitignore` - Comprehensive Docker-specific exclusions
- `README.md` - Bilingual quick start guide with complete project overview

**New Directories:**
- `config/postgresql/`, `config/redis/`, `config/seaweedfs/`, `config/caddy/`
- `config/n8n/workflows/`, `config/chatwoot/`, `config/evolution/`, `config/duplicati/`
- `scripts/`
- `docs/03-services/`, `docs/04-integrations/`
- `tests/integration/`, `tests/deployment/`
- `.github/workflows/`

## QA Results

### Review Date: 2025-09-30

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall Quality: Exemplary**

This story establishes the foundational repository structure for BorgStack with outstanding quality. The implementation demonstrates excellent attention to detail, comprehensive documentation, and strict adherence to architectural specifications and coding standards.

**Key Strengths:**
- Complete and accurate directory structure matching architecture specification
- Professional-grade bilingual documentation (EN/PT-BR)
- Comprehensive environment variable template with security best practices
- Robust CI/CD validation pipeline
- Proper Docker Compose file organization (base, override, prod)
- Well-structured .gitignore with clear categorization

### Refactoring Performed

No refactoring was required. The implementation is production-ready as delivered.

### Compliance Check

- **Coding Standards:** ✓ Full compliance
  - Docker Compose v2 format used correctly
  - Network naming follows `borgstack_*` convention
  - Volume naming follows `borgstack_*` convention
  - No `latest` tags in configuration (placeholder structure only)
  - Environment variable security properly configured
  - Shell script naming conventions ready for Story 1.6

- **Project Structure:** ✓ Full compliance
  - All directories from source-tree.md created exactly as specified
  - Proper separation of concerns (config/, docs/, scripts/, tests/)
  - GitHub workflows directory properly established

- **Testing Strategy:** ✓ Full compliance
  - Appropriate validation approach for infrastructure project
  - CI workflow validates Docker Compose syntax
  - CI workflow verifies directory structure
  - CI workflow checks naming conventions
  - CI workflow validates .gitignore effectiveness

- **All ACs Met:** ✓ 8/8 Acceptance Criteria fully satisfied

### Acceptance Criteria Validation

| AC | Status | Validation Notes |
|----|--------|-----------------|
| 1. Monorepo structure | ✓ PASS | All directories from source-tree.md exist and match specification |
| 2. docker-compose.yml centerpiece | ✓ PASS | Present with proper networks (borgstack_internal, borgstack_external) |
| 3. Separate directories | ✓ PASS | config/, docs/, scripts/, tests/ all created with proper subdirectories |
| 4. .gitignore for Docker | ✓ PASS | Comprehensive .gitignore with all required exclusions |
| 5. .env.example template | ✓ PASS | All required variables with excellent security documentation |
| 6. .env exclusion | ✓ PASS | .env, .env.local, .env.*.local properly ignored |
| 7. README.md | ✓ PASS | Bilingual (EN/PT-BR), comprehensive, professional quality |
| 8. Version control setup | ✓ PASS | Branching strategy documented, CI configured with branch filters |

### Improvements Checklist

All requirements met in initial implementation. No improvements needed.

**Future Considerations (Non-blocking):**
- [ ] Consider adding shellcheck validation when shell scripts are implemented in Story 1.6
- [ ] Consider adding markdownlint for documentation consistency as docs grow

### Security Review

**Status: PASS** - No security concerns identified.

**Findings:**
- ✅ Environment variables properly secured in .gitignore
- ✅ No secrets or credentials in repository
- ✅ Comprehensive security warnings in .env.example
- ✅ Minimum 32-character password requirements documented
- ✅ Instructions for proper .env file permissions (chmod 600)
- ✅ Clear warnings against committing sensitive files
- ✅ SSL certificate files properly excluded (.pem, .key, .crt)

### Performance Considerations

**Status: PASS** - No performance concerns for infrastructure setup.

**Findings:**
- ✅ Docker Compose configuration follows best practices
- ✅ Network isolation properly configured for security and performance
- ✅ Production configuration includes resource limits (placeholder structure ready)
- ✅ Configuration-as-code approach enables version control and rollback

### Files Modified During Review

None. No modifications were necessary during QA review.

### Test Execution Results

All validation tests passed successfully:

```bash
✅ docker compose config --quiet (exit 0)
✅ docker compose -f docker-compose.yml -f docker-compose.override.yml config --quiet (exit 0)
✅ docker compose -f docker-compose.yml -f docker-compose.prod.yml config --quiet (exit 0)
✅ git status --ignored (confirms .env files would be properly ignored)
```

### Gate Status

**Gate: PASS** → `docs/qa/gates/1.1-project-repository-structure.yml`

**Quality Score: 100/100**

**Summary:** All 8 acceptance criteria fully implemented with excellent quality. Infrastructure foundation is solid, well-documented, and follows all coding standards. No blocking or concerning issues identified.

**Gate Expiry:** 2025-10-14

### Recommended Status

**✓ Ready for Done**

All acceptance criteria met, all standards complied with, no changes required. This story is production-ready and can be marked as Done.
