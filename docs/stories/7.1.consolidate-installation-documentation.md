# Story 7.1: Consolidate Installation Documentation

## Status
Approved

## Story
**As a** new user,
**I want** streamlined installation documentation,
**so that** I can understand and deploy BorgStack in 30 minutes instead of reading 6 hours of documentation.

## Acceptance Criteria
1. README.md (100-150 lines) contains: project description, service list, Quick Start (5 commands), documentation links
2. INSTALL.md (150-200 lines) contains: local mode installation, production mode installation, installation troubleshooting
3. Zero overlap or repetition between README.md and INSTALL.md
4. All installation commands tested and functional
5. Old files deleted: docs/README.md, docs/00-inicio-rapido.md, docs/01-instalacao.md
6. Protected files untouched: docs/prd/, docs/architecture/, docs/qa/, docs/stories/, CLAUDE.md, CONTRIBUTING.md, LICENSE

## Tasks / Subtasks

- [ ] **Task 0: Review Current Documentation State** (AC: 1, 2, 3, 5, 6)
  - [ ] Read current README.md (364 lines) to understand existing content
  - [ ] Read docs/README.md (478 lines) to understand doc hub structure
  - [ ] Read docs/00-inicio-rapido.md (1213 lines) to extract Quick Start content
  - [ ] Read docs/01-instalacao.md (1476 lines) to extract installation procedures
  - [ ] Identify content to preserve vs content to remove
  - [ ] Map content from 4 files (3531 total lines) to 2 target files (250-350 lines total)
  - [ ] Document critical content that must be preserved (bootstrap script details, system requirements, mDNS/LAN mode)

- [ ] **Task 1: Create New README.md** (AC: 1, 3)
  - [ ] **Section 1: Project Description (10-15 lines)**
    - [ ] Preserve BorgStack Borg metaphor introduction
    - [ ] List 12 services with versions in table format
    - [ ] Brief value proposition (one-command deployment)
  - [ ] **Section 2: Quick Start (30-40 lines)**
    - [ ] System requirements (bullet list)
    - [ ] 5-command quick start:
      1. `git clone ...`
      2. `cd borgstack`
      3. `./scripts/bootstrap.sh`
      4. Select mode (Local/Production)
      5. Access services
    - [ ] Note about bootstrap script handling everything automatically
  - [ ] **Section 3: Service List Table (15-20 lines)**
    - [ ] Table with columns: Service, Purpose, Version
    - [ ] All 12 services listed
    - [ ] Link to full docs for details
  - [ ] **Section 4: Documentation Links (10-15 lines)**
    - [ ] Link to INSTALL.md for detailed installation
    - [ ] Link to CONFIGURATION.md (from Story 7.2)
    - [ ] Link to TROUBLESHOOTING.md (from Story 7.3)
    - [ ] Link to docs/services.md, docs/integrations.md, docs/maintenance.md
  - [ ] **Section 5: License and Support (10-15 lines)**
    - [ ] MIT license link
    - [ ] GitHub Issues link
    - [ ] Security best practices link
  - [ ] **Validation:**
    - [ ] Total lines: 100-150
    - [ ] Zero duplication with INSTALL.md
    - [ ] All links functional
    - [ ] Markdown passes linting

- [ ] **Task 2: Create New INSTALL.md** (AC: 2, 3)
  - [ ] **Section 1: Prerequisites (20-30 lines)**
    - [ ] Hardware requirements (CPU, RAM, Disk from current docs)
    - [ ] Debian/Ubuntu requirement for bootstrap script
    - [ ] Manual installation note for other distros
    - [ ] Network requirements (ports 80, 443, optional mDNS)
  - [ ] **Section 2: Local Mode Installation (40-60 lines)**
    - [ ] What is Local Mode (LAN access, mDNS, no SSL)
    - [ ] When to use Local Mode (development, testing, LAN-only)
    - [ ] Installation command: `./scripts/bootstrap.sh` → Select "Local"
    - [ ] What bootstrap script does in Local Mode:
      - Installs Avahi/mDNS (if not present)
      - Configures docker-compose.override.yml
      - Exposes database ports for debugging
      - Sets up http://hostname.local:8080 access
    - [ ] Post-installation: How to access services (mDNS URLs)
    - [ ] Testing: Verify mDNS with `ping $(hostname).local`
  - [ ] **Section 3: Production Mode Installation (40-60 lines)**
    - [ ] What is Production Mode (Internet access, SSL, domains)
    - [ ] When to use Production Mode (public deployment)
    - [ ] Pre-requisites:
      - Domain name ownership
      - DNS configured (A records for subdomains)
      - Public IP accessible on ports 80/443
    - [ ] Installation command: `./scripts/bootstrap.sh` → Select "Production"
    - [ ] What bootstrap script does in Production Mode:
      - Uses docker-compose.prod.yml
      - Configures Caddy for automatic SSL
      - Restricts database port exposure
      - Sets up https://service.domain.com access
    - [ ] Post-installation:
      - DNS propagation wait (5-30 minutes)
      - Test DNS with `dig` commands
      - First HTTPS access triggers Let's Encrypt
      - Verify SSL certificates
  - [ ] **Section 4: Installation Troubleshooting (30-40 lines)**
    - [ ] **Issue 1: Bootstrap script fails system validation**
      - Symptom: "Insufficient RAM" or "Unsupported distribution"
      - Solution: Check minimum requirements, use manual installation on non-Debian/Ubuntu
    - [ ] **Issue 2: Docker installation fails**
      - Symptom: "Docker not found" after bootstrap
      - Solution: Check `/tmp/borgstack-bootstrap.log`, install Docker manually
    - [ ] **Issue 3: mDNS not working (Local Mode)**
      - Symptom: `hostname.local` not resolving
      - Solution: Verify Avahi installed, check `systemctl status avahi-daemon`
    - [ ] **Issue 4: SSL certificate generation fails (Production Mode)**
      - Symptom: "failed to obtain certificate" in Caddy logs
      - Solution: Verify DNS propagation, check ports 80/443 accessible, check Let's Encrypt rate limits
    - [ ] **Issue 5: Services not starting**
      - Symptom: `docker compose ps` shows unhealthy containers
      - Solution: Check `docker compose logs SERVICE`, verify .env file, check health checks
    - [ ] Link to TROUBLESHOOTING.md for more issues
  - [ ] **Validation:**
    - [ ] Total lines: 150-200
    - [ ] Zero duplication with README.md
    - [ ] All commands tested
    - [ ] Both modes (Local and Production) clearly documented

- [ ] **Task 3: Delete Old Documentation Files** (AC: 5, 6)
  - [ ] **Pre-deletion verification:**
    - [ ] Confirm new README.md and INSTALL.md created and validated
    - [ ] Double-check protected files list:
      - [ ] docs/brief.md (PROTECTED - do not touch)
      - [ ] docs/prd.md (PROTECTED - do not touch)
      - [ ] docs/architecture.md (PROTECTED - do not touch)
      - [ ] docs/prd/ directory (PROTECTED - do not touch)
      - [ ] docs/architecture/ directory (PROTECTED - do not touch)
      - [ ] docs/qa/ directory (PROTECTED - do not touch)
      - [ ] docs/stories/ directory (PROTECTED - do not touch)
      - [ ] CLAUDE.md (PROTECTED - do not touch)
      - [ ] CONTRIBUTING.md (PROTECTED - do not touch)
      - [ ] LICENSE (PROTECTED - do not touch)
  - [ ] **Execute deletions:**
    - [ ] Delete docs/README.md (478 lines)
    - [ ] Delete docs/00-inicio-rapido.md (1213 lines)
    - [ ] Delete docs/01-instalacao.md (1476 lines)
  - [ ] **Post-deletion verification:**
    - [ ] Verify protected files still exist and unchanged
    - [ ] Run git status to confirm only intended files deleted
    - [ ] Verify no broken links in remaining documentation

- [ ] **Task 4: Update Internal Links** (AC: 3, 4)
  - [ ] **Update links in CONTRIBUTING.md** (if it references old files)
  - [ ] **Update links in docker-compose.yml comments** (if any)
  - [ ] **Update links in scripts/bootstrap.sh** (if it references docs)
  - [ ] **Verify all markdown links functional:**
    - [ ] Run markdown link checker on README.md
    - [ ] Run markdown link checker on INSTALL.md
    - [ ] Manually test all documentation links
  - [ ] **Create placeholder note for Story 7.2 dependencies:**
    - [ ] README.md links to CONFIGURATION.md (will be created in 7.2)
    - [ ] README.md links to docs/services.md (will be created in 7.2)
    - [ ] Add comment: "Note: These links will be functional after Story 7.2"

- [ ] **Task 5: Test Installation Commands** (AC: 4)
  - [ ] **Test Local Mode installation:**
    - [ ] Run `./scripts/bootstrap.sh` and select "Local"
    - [ ] Verify Avahi/mDNS installation
    - [ ] Verify `http://hostname.local:8080/n8n` accessible
    - [ ] Verify database ports exposed (5432, 6379, 27017)
    - [ ] Verify docker-compose.override.yml loaded
  - [ ] **Test Production Mode installation (if possible):**
    - [ ] Note: Full production test requires domain/DNS
    - [ ] Verify bootstrap script generates correct .env
    - [ ] Verify docker-compose.prod.yml loaded
    - [ ] Verify Caddyfile.prod configuration
  - [ ] **Validate all documented commands:**
    - [ ] Test every bash command in README.md
    - [ ] Test every bash command in INSTALL.md
    - [ ] Verify expected outputs match documentation

- [ ] **Task 6: Final Quality Check** (AC: 1, 2, 3, 5, 6)
  - [ ] **Line count validation:**
    - [ ] `wc -l README.md` → verify 100-150 lines
    - [ ] `wc -l INSTALL.md` → verify 150-200 lines
    - [ ] Total: 250-350 lines (down from 3531 lines)
  - [ ] **Content validation:**
    - [ ] README.md has all 5 required sections
    - [ ] INSTALL.md covers both Local and Production modes
    - [ ] Zero overlap between README.md and INSTALL.md verified
    - [ ] No content duplication detected
  - [ ] **Deletion validation:**
    - [ ] Confirm 3 old files deleted (docs/README.md, docs/00-inicio-rapido.md, docs/01-instalacao.md)
    - [ ] Verify protected files unchanged:
      ```bash
      ls -la docs/brief.md docs/prd.md docs/architecture.md CLAUDE.md CONTRIBUTING.md LICENSE
      ls -la docs/prd/ docs/architecture/ docs/qa/ docs/stories/
      ```
  - [ ] **Functionality validation:**
    - [ ] All commands tested and working
    - [ ] All links verified functional (or marked for Story 7.2)
    - [ ] Bootstrap script instructions accurate
  - [ ] **Portuguese quality check:**
    - [ ] Verify Brazilian Portuguese grammar and spelling
    - [ ] Maintain consistent terminology with Story 6.2/6.3 precedent

## Dev Notes

### Previous Story Insights

**From Story 6.4 (Component Update Procedures):**
[Source: docs/stories/6.4.component-update-procedures.md]

- **Portuguese Documentation Quality:** Story 6.4 maintained excellent Brazilian Portuguese quality from Stories 6.2-6.3. Story 7.1 documentation must maintain same natural language standard.
- **Diátaxis Framework Compliance:** Previous stories properly implemented How-to Guide structure. Story 7.1 must ensure README.md remains a high-level overview (Explanation/Reference) and INSTALL.md follows Tutorial structure (learning-oriented, step-by-step).
- **Cross-Reference Integration:** Stories 6.3-6.4 successfully integrated new docs into navigation. Story 7.1 must update all cross-references when deleting old files.
- **Command Verification:** Story 6.4 emphasized testing all bash commands. Story 7.1 must test bootstrap script commands in both Local and Production modes.

**From Story 6.3 (User Guides and Tutorials):**
[Source: docs/stories/6.3.user-guides-tutorials.story.md]

- **Copy-Pasteable Commands:** All bash commands must be tested and copy-pasteable without modification
- **Concise Examples:** Prefer short, focused examples over long explanations
- **Natural Language:** Use conversational Brazilian Portuguese, avoid overly formal language

**From Story 6.2 (Portuguese Documentation):**
[Source: docs/stories/6.2.portuguese-documentation.story.md]

- **Existing Bootstrap Script Documentation:** docs/01-instalacao.md and README.md contain comprehensive bootstrap script documentation including Local Mode (mDNS) and Production Mode (SSL)
- **Key Content to Preserve:**
  - Bootstrap script two-mode system (Local/Production)
  - mDNS/Avahi setup for LAN access
  - System requirements validation
  - Firewall configuration (UFW)
  - Health check validation post-install
- **Content to Remove:**
  - Redundant installation steps (docs have 3x duplication)
  - Overly detailed explanations (distilled to essentials)
  - Third-party tool documentation (PostgreSQL tutorials, Redis config details)

### Epic 7 Context

**Epic 7 Goal:** Simplify BorgStack documentation from ~32,000 lines across 29 files to ~1,400 lines in 6 essential files.
[Source: docs/prd/epic-details.md Epic 7]

**Story 7.1 Scope:**
- Consolidate 4 files (README.md, docs/README.md, docs/00-inicio-rapido.md, docs/01-instalacao.md) → 2 files (README.md, INSTALL.md)
- Reduce from 3531 total lines → 250-350 lines (90% reduction)
- Focus on installation only (configuration and operations deferred to Stories 7.2-7.3)

**Protected Files - NEVER MODIFY OR DELETE:**
[Source: docs/prd/epic-details.md Epic 7 CRITICAL section]
- docs/brief.md
- docs/prd.md
- docs/architecture.md
- All files in: docs/prd/, docs/architecture/, docs/qa/, docs/stories/
- CLAUDE.md
- CONTRIBUTING.md
- LICENSE

### Architecture Context

**Documentation Standards:**
[Source: docs/architecture/coding-standards.md]

- **File Naming:** kebab-case.md (README.md is exception as standard)
- **Documentation Language:** Brazilian Portuguese for user-facing docs
- **Markdown Standards:**
  - Use GitHub-flavored markdown
  - Headers use ATX style (`#` not `===`)
  - Code blocks always have language specified
  - Links use reference style for readability

**Project Structure for Documentation:**
[Source: docs/architecture/unified-project-structure.md]

```
borgstack/
├── README.md                   # Root project overview (to be replaced in 7.1)
├── INSTALL.md                  # Installation guide (to be created in 7.1)
├── CONFIGURATION.md            # Configuration guide (Story 7.2)
├── TROUBLESHOOTING.md          # Troubleshooting guide (Story 7.3)
├── CONTRIBUTING.md             # PROTECTED - do not touch
├── LICENSE                     # PROTECTED - do not touch
├── CLAUDE.md                   # PROTECTED - do not touch
└── docs/
    ├── services.md             # Service-specific guides (Story 7.2)
    ├── integrations.md         # Integration tutorials (Story 7.3)
    ├── maintenance.md          # Maintenance guide (Story 7.3)
    ├── brief.md                # PROTECTED - do not touch
    ├── prd.md                  # PROTECTED - do not touch
    ├── architecture.md         # PROTECTED - do not touch
    ├── prd/                    # PROTECTED - entire directory
    ├── architecture/           # PROTECTED - entire directory
    ├── qa/                     # PROTECTED - entire directory
    └── stories/                # PROTECTED - entire directory
```

**Bootstrap Script Details:**
[Source: README.md lines 76-157, docs/01-instalacao.md]

- **Script Location:** `scripts/bootstrap.sh`
- **Two Modes:**
  1. **Local Mode (LAN):**
     - Uses docker-compose.override.yml
     - Installs Avahi for mDNS (`hostname.local`)
     - Access via `http://hostname.local:8080/SERVICE`
     - Exposes database ports for debugging (5432, 6379, 27017)
     - No SSL/HTTPS
     - Firewall opens mDNS port (5353 UDP)
  2. **Production Mode:**
     - Uses docker-compose.prod.yml
     - Access via `https://service.domain.com`
     - Automatic SSL via Let's Encrypt through Caddy
     - Requires DNS configuration
     - Database ports NOT exposed
     - Firewall restricted to 22, 80, 443

- **What Bootstrap Script Does:**
  1. System validation (RAM, disk, CPU, distribution)
  2. Docker Engine installation (if not present)
  3. Docker Compose v2 installation
  4. Utility installation (curl, wget, git, ufw, dig, htop, sysstat)
  5. Firewall configuration (UFW)
  6. Mode-specific setup (Avahi/mDNS for Local, DNS prompts for Production)
  7. .env file generation with strong passwords
  8. Docker Compose deployment
  9. Health check validation
  10. Post-install instructions

**System Requirements:**
[Source: README.md lines 9-16]

- **OS:** Debian or Ubuntu (bootstrap script requirement)
- **CPU:** 4 vCPU minimum, 8 recommended
- **RAM:** 8 GB minimum, 18 GB recommended
- **Storage:** 100 GB SSD minimum, 250 GB recommended
- **Network:** Public IP with ports 80/443 accessible (Production mode)

**Service List:**
[Source: docs/architecture/tech-stack.md]

| Service | Version | Purpose |
|---------|---------|---------|
| n8n | 1.112.6 | Workflow automation |
| Evolution API | v2.2.3 | WhatsApp Business API |
| Chatwoot | v4.6.0-ce | Omnichannel customer service |
| Lowcoder | 2.7.4 | Low-code application builder |
| Directus | 11 | Headless CMS |
| FileFlows | 25.09 | Media processing automation |
| SeaweedFS | 3.97 | S3-compatible object storage |
| Duplicati | 2.1.1.102 | Encrypted backup automation |
| PostgreSQL | 18.0 | Relational database (with pgvector) |
| MongoDB | 7.0 | NoSQL database (Lowcoder only) |
| Redis | 8.2 | Cache and message queue |
| Caddy | 2.10 | Reverse proxy with automatic SSL |

### Content Mapping Strategy

**README.md (100-150 lines) - High-level overview:**
1. Project description (Borg metaphor) - FROM current README.md lines 1-3
2. Quick Start (5 commands) - DISTILLED from README.md lines 7-73
3. Service list table - FROM docs/architecture/tech-stack.md
4. Documentation links - NEW (links to INSTALL.md, CONFIGURATION.md, etc.)
5. License and support - FROM current README.md lines 340-361

**INSTALL.md (150-200 lines) - Installation tutorial:**
1. Prerequisites - FROM README.md lines 9-16 + docs/01-instalacao.md
2. Local Mode installation - FROM README.md lines 26-157 + docs/00-inicio-rapido.md
3. Production Mode installation - FROM README.md lines 39-44 + docs/01-instalacao.md
4. Installation troubleshooting - FROM docs/05-solucao-de-problemas.md (installation section only)

**Content to REMOVE (redundant/verbose):**
- docs/README.md (entire doc hub structure - no longer needed with simplified docs)
- docs/00-inicio-rapido.md (1213 lines - mostly redundant with README.md bootstrap section)
- docs/01-instalacao.md (1476 lines - contains too much detail, manual installation steps, third-party tutorials)

### Project Structure Alignment

**No Conflicts Detected:**

All file operations align with defined project structure:
[Source: docs/architecture/unified-project-structure.md]

- **Files to Create:**
  - README.md (root) - REPLACE existing
  - INSTALL.md (root) - CREATE new

- **Files to Delete:**
  - docs/README.md - SAFE to delete (not protected)
  - docs/00-inicio-rapido.md - SAFE to delete (not protected)
  - docs/01-instalacao.md - SAFE to delete (not protected)

- **Protected Files Verification:**
  - None of the deletion targets are in the protected list
  - All deletions are user-facing documentation only
  - No architecture, PRD, QA, or story files will be touched

**Cross-References to Update:**
- CONTRIBUTING.md - may reference old documentation structure
- scripts/bootstrap.sh - may reference docs/01-instalacao.md
- docker-compose.yml - unlikely to have doc references, but verify

**Links to Future Stories:**
- README.md will link to CONFIGURATION.md (created in Story 7.2)
- README.md will link to TROUBLESHOOTING.md (created in Story 7.3)
- README.md will link to docs/services.md, docs/integrations.md, docs/maintenance.md (created in Stories 7.2-7.3)
- These links should be documented with notes that they'll be functional after subsequent stories

## Testing

### Test Requirements

**Documentation Testing Approach:**
[Source: docs/architecture/testing-strategy.md]

**No Unit Tests Required:**
- Documentation is not code
- Focus on manual validation and functional testing
- Verify all commands work as documented

**Testing Checklist for Story 7.1:**

1. **Content Accuracy Testing:**
   - Execute every bash command in README.md
   - Execute every bash command in INSTALL.md
   - Verify bootstrap script works in both modes
   - Verify expected outputs match documentation

2. **Link Validation:**
   - Test all internal markdown links
   - Verify external links (GitHub, official docs)
   - Ensure no broken links after deletions
   - Document future links for Stories 7.2-7.3

3. **Line Count Validation:**
   - `wc -l README.md` → 100-150 lines
   - `wc -l INSTALL.md` → 150-200 lines
   - Total reduction from 3531 lines to 250-350 lines verified

4. **Deletion Safety:**
   - Verify only intended files deleted (3 files)
   - Confirm all protected files unchanged
   - Run git status to verify deletions

5. **Bootstrap Script Testing:**
   - Test Local Mode installation on clean system
   - Verify mDNS/Avahi installation
   - Verify `hostname.local:8080` access works
   - Verify database port exposure in Local Mode
   - Document Production Mode testing (requires domain/DNS)

6. **Portuguese Quality Check:**
   - Grammar and spelling verification
   - Terminology consistency with Stories 6.2-6.4
   - Natural language flow (conversational, not overly formal)

**Validation Commands:**

```bash
# 1. Verify line counts
wc -l README.md INSTALL.md
# Expected: README.md 100-150, INSTALL.md 150-200

# 2. Verify old files deleted
ls docs/README.md docs/00-inicio-rapido.md docs/01-instalacao.md 2>/dev/null
# Expected: "No such file or directory"

# 3. Verify protected files exist
ls docs/brief.md docs/prd.md docs/architecture.md CLAUDE.md CONTRIBUTING.md LICENSE
ls -d docs/prd/ docs/architecture/ docs/qa/ docs/stories/
# Expected: All files/directories exist

# 4. Test bootstrap script (Local Mode)
./scripts/bootstrap.sh
# Select "Local Mode"
# Verify Avahi installed: systemctl status avahi-daemon
# Verify mDNS works: ping $(hostname).local
# Verify services: docker compose ps
# Verify access: curl http://$(hostname).local:8080/n8n/healthz

# 5. Verify no duplicate content
diff <(grep -o "Quick Start" README.md) <(grep -o "Quick Start" INSTALL.md)
# Expected: Different context, no duplication

# 6. Check markdown link validity
# (Manual check or use markdown-link-check tool)
npx markdown-link-check README.md
npx markdown-link-check INSTALL.md
```

**Expected Deliverables:**
- 1 new file: INSTALL.md (150-200 lines)
- 1 replaced file: README.md (100-150 lines, down from 364)
- 3 deleted files: docs/README.md, docs/00-inicio-rapido.md, docs/01-instalacao.md
- Updated cross-references in CONTRIBUTING.md, scripts/bootstrap.sh (if needed)
- Total documentation reduction: 3531 lines → 250-350 lines (90% reduction)
- All bootstrap script commands tested and functional

**Performance Expectations:**
- README.md reading time: < 5 minutes (down from 30+ minutes across old files)
- INSTALL.md reading time: < 10 minutes (down from 2+ hours)
- Time to deployment (with bootstrap script): < 30 minutes
- Zero broken links after deletions

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-16 | 1.0 | Initial story creation for Epic 7 (Documentation Simplification) | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
(To be populated by Dev Agent)

### Debug Log References
(To be populated by Dev Agent)

### Completion Notes List
(To be populated by Dev Agent)

### File List
(To be populated by Dev Agent)

## QA Results
(To be populated by QA Agent)
