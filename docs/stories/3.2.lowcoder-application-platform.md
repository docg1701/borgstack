# Story 3.2: Lowcoder Application Platform

## Status
Approved

## Story
**As a** application developer,
**I want** Lowcoder 2.7.4 deployed with external MongoDB and Redis connections,
**so that** I can build custom applications with proper metadata storage.

## Acceptance Criteria
1. Lowcoder container running with specified version
2. Connection to external MongoDB working (LOWCODER_MONGODB_URL)
3. Connection to external Redis working (LOWCODER_REDIS_URL)
4. Application deployment and management working
5. User authentication and authorization functional
6. Basic application templates available

## Tasks / Subtasks

- [ ] **Task 1: Add Lowcoder Service to docker-compose.yml** (AC: 1, 2, 3)
  - [ ] Add Lowcoder service definition using `lowcoderorg/lowcoder-ce:2.7.4` image
  - [ ] Configure Lowcoder on both `borgstack_internal` and `borgstack_external` networks
  - [ ] Mount persistent volume `borgstack_lowcoder_stacks` to `/lowcoder-stacks`
  - [ ] Set MongoDB connection environment variable (LOWCODER_MONGODB_URL)
  - [ ] Set Redis connection environment variable (LOWCODER_REDIS_URL)
  - [ ] Configure other required environment variables (LOWCODER_API_SERVICE_URL, etc.)
  - [ ] Add restart policy: `unless-stopped`
  - [ ] Configure container name: `lowcoder`
  - [ ] Add dependency on `mongodb` (condition: service_healthy)
  - [ ] Add dependency on `redis` (condition: service_healthy)

- [ ] **Task 2: Configure Lowcoder Environment Variables** (AC: 1, 2, 3, 5)
  - [ ] Set LOWCODER_MONGODB_URL to `mongodb://lowcoder_user:${LOWCODER_DB_PASSWORD}@mongodb:27017/lowcoder?authSource=lowcoder`
  - [ ] Set LOWCODER_REDIS_URL to `redis://:${REDIS_PASSWORD}@redis:6379`
  - [ ] Set LOWCODER_API_SERVICE_URL to `http://lowcoder:3000` (internal API endpoint)
  - [ ] Set LOWCODER_NODE_SERVICE_URL to `http://lowcoder:6060` (Node service)
  - [ ] Configure default admin credentials (LOWCODER_ADMIN_EMAIL, LOWCODER_ADMIN_PASSWORD)
  - [ ] Set LOWCODER_ENCRYPTION_PASSWORD (32-char for application encryption)
  - [ ] Set LOWCODER_ENCRYPTION_SALT (32-char salt for encryption)

- [ ] **Task 3: Implement Lowcoder Health Check** (AC: 1)
  - [ ] Add health check using `curl -f http://localhost:3000/api/health || exit 1`
  - [ ] Set health check interval to 30 seconds
  - [ ] Set timeout to 10 seconds
  - [ ] Set retries to 5 before marking unhealthy
  - [ ] Set start_period to 60 seconds (Java Spring Boot + Node.js initialization)

- [ ] **Task 4: Update .env.example with Lowcoder Variables** (AC: 1, 2, 3, 5)
  - [ ] Add LOWCODER_HOST variable (subdomain configuration)
  - [ ] Add LOWCODER_ADMIN_EMAIL placeholder with example
  - [ ] Add LOWCODER_ADMIN_PASSWORD placeholder with security warning
  - [ ] Add LOWCODER_ENCRYPTION_PASSWORD placeholder (32-char requirement)
  - [ ] Add LOWCODER_ENCRYPTION_SALT placeholder (32-char requirement)
  - [ ] Add comprehensive security warnings for credential management

- [ ] **Task 5a: Verify Lowcoder Caddy Configuration** (AC: 1)
  - [ ] Verify Caddyfile reverse proxy block exists for `lowcoder.{DOMAIN}`
  - [ ] Verify proxy target set to `http://lowcoder:3000`
  - [ ] Verify security headers configured

- [ ] **Task 5b: Test Lowcoder Web UI via Caddy** (AC: 1, 4, 5)
  - [ ] Requires DNS configuration for lowcoder.{DOMAIN}
  - [ ] Verify HTTPS redirect working
  - [ ] Verify login page accessible
  - [ ] Verify SSL certificate issued by Let's Encrypt
  - [ ] (Runtime test - to be executed during deployment, not in CI)

- [ ] **Task 6: Verify MongoDB Database Configuration** (AC: 2)
  - [ ] Verify `lowcoder` database creation in init-mongo.js (already exists from Story 1.7)
  - [ ] Verify `lowcoder_user` creation with proper permissions
  - [ ] Verify database ownership assigned to lowcoder_user
  - [ ] Test connection string format is correct

- [ ] **Task 7: Add Lowcoder Password Generation to Bootstrap Script** (AC: 5)
  - [ ] Add LOWCODER_ADMIN_PASSWORD generation (32-char alphanumeric via openssl)
  - [ ] Add LOWCODER_ENCRYPTION_PASSWORD generation (32-char alphanumeric)
  - [ ] Add LOWCODER_ENCRYPTION_SALT generation (32-char alphanumeric)
  - [ ] Add LOWCODER_HOST to .env file generation
  - [ ] Add LOWCODER_ADMIN_EMAIL to .env file (with user prompt)

- [ ] **Task 8: Create Lowcoder Setup Documentation** (AC: 4, 5, 6)
  - [ ] Create config/lowcoder/README.md with comprehensive setup guide
  - [ ] Document first-time admin account login (validates AC 5)
  - [ ] Document basic application creation workflow (validates AC 4)
  - [ ] Document data source connection setup (PostgreSQL, REST APIs) (validates AC 4)
  - [ ] Document user management and permissions (validates AC 5)
  - [ ] Document basic application templates (CRUD, Dashboard, Form examples) (validates AC 6)
  - [ ] Troubleshooting guide for common issues

- [ ] **Task 9: Create Lowcoder Validation Tests** (AC: 1, 2, 3, 4, 5)
  - [ ] Create tests/deployment/verify-lowcoder.sh and make executable (chmod +x)
  - [ ] Test 1: Verify Lowcoder image version (lowcoderorg/lowcoder-ce:2.7.4)
  - [ ] Test 2: Verify Lowcoder connected to borgstack_internal network
  - [ ] Test 3: Verify Lowcoder connected to borgstack_external network
  - [ ] Test 4: Verify volume borgstack_lowcoder_stacks mounted correctly
  - [ ] Test 5: Verify no port exposure to host (security requirement)
  - [ ] Test 6: Verify health check configured
  - [ ] Test 7: Verify MongoDB connection string (LOWCODER_MONGODB_URL)
  - [ ] Test 8: Verify Redis connection string (LOWCODER_REDIS_URL)
  - [ ] Test 9: Verify admin credentials configured
  - [ ] Test 10: Verify encryption keys configured

- [ ] **Task 10: Add Lowcoder to CI Validation** (AC: 1, 2, 3)
  - [ ] Add validate-lowcoder job to .github/workflows/ci.yml
  - [ ] Validate service configuration and environment variables
  - [ ] Validate dependencies on MongoDB and Redis
  - [ ] Validate documentation and test files exist
  - [ ] Validate YAML syntax

- [ ] **Task 11: Create n8n Integration Example Workflow** (AC: 4)
  - [ ] Create config/n8n/workflows/05-lowcoder-webhook-integration.json
  - [ ] Demonstrate webhook trigger from Lowcoder app to n8n workflow
  - [ ] Document API query configuration in Lowcoder to call n8n endpoints
  - [ ] Update config/n8n/workflows/README.md with integration pattern

- [ ] **Task 12: Update Documentation** (AC: 1, 4, 5, 6)
  - [ ] Add Lowcoder service access section to README.md (English)
  - [ ] Add Lowcoder troubleshooting section to README.md (English)
  - [ ] Verify Lowcoder already listed in Portuguese services table

## Dev Notes

### Previous Story Insights

**Key Learnings from Story 3.1 (Chatwoot):**
- Strong password generation pattern: `openssl rand -base64 32` (32-char alphanumeric)
- Health check start_period must account for initialization time (Rails: 90s, Spring Boot: 60s recommended)
- Network isolation: Services on `borgstack_internal` (databases) + `borgstack_external` (Caddy access)
- Manual configuration emphasis: Document post-deployment steps clearly with CRITICAL warnings
- Comprehensive documentation is essential: Setup guides with troubleshooting sections
- CI validation prevents configuration errors: Validate env vars, dependencies, and file structure

### Architecture Context

**Files to Modify:**
- `docker-compose.yml` - Add Lowcoder service definition
- `.env.example` - Add Lowcoder environment variables
- `scripts/bootstrap.sh` - Add Lowcoder credential generation
- `.github/workflows/ci.yml` - Add Lowcoder validation job
- `config/n8n/workflows/README.md` - Document Lowcoder integration example
- `README.md` - Document Lowcoder service access

**Files to Create:**
- `config/lowcoder/README.md` - Comprehensive Lowcoder setup and usage guide
- `tests/deployment/verify-lowcoder.sh` - 10 validation tests for Lowcoder deployment
- `config/n8n/workflows/05-lowcoder-webhook-integration.json` - n8n ↔ Lowcoder integration example

**Already Configured (Verify Only):**
- `config/mongodb/init-mongo.js` - lowcoder database and lowcoder_user already configured (Story 1.7)
- `config/caddy/Caddyfile` - Lowcoder reverse proxy block already configured (Story 1.5)

**File Path Standards** [Source: architecture/unified-project-structure.md]
- Configuration files: `config/<service>/` directory
- Test scripts: `tests/deployment/` and `tests/integration/`
- Scripts: `scripts/` directory with kebab-case naming

### Tech Stack Context

**Lowcoder Version Selection** [Source: architecture/tech-stack.md]
- Version: Lowcoder 2.7.4 (`lowcoderorg/lowcoder-ce:2.7.4` Docker image)
- Rationale: Optional low-code platform for custom internal tools; connects to PostgreSQL and Redis
- Image source: Official Lowcoder Docker Hub repository
- Backend: Java Spring Boot + Node.js (dual service architecture)
- Frontend: React
- License: Open Source Community Edition

**Related Infrastructure** [Source: architecture/tech-stack.md]
- Docker Compose v2 for orchestration
- Docker volumes for persistent storage (application definitions, custom components)
- Docker networks for service isolation (`borgstack_internal`, `borgstack_external`)

### Component Architecture

**Lowcoder Component Details** [Source: architecture/components.md#lowcoder-low-code-application-builder]

**Responsibility:** Optional low-code platform for building custom internal business applications.

**Key Interfaces:**
- Web UI (port 3000) exposed via Caddy
- Application runtime for deployed apps
- API query builder connecting to PostgreSQL and other services

**Dependencies:**
- MongoDB (`lowcoder` database via LOWCODER_MONGODB_URL)
- Redis (via LOWCODER_REDIS_URL)
- PostgreSQL (optional, for custom applications connecting to SQL data)

**Technology Stack:**
- Image: `lowcoderorg/lowcoder-ce:2.7.4`
- Volume: `borgstack_lowcoder_stacks` for application definitions
- Configuration: MongoDB and Redis connection strings

### Database Configuration

**MongoDB Database for Lowcoder** [Source: architecture/database-schema.md#mongodb-database-organization]

**Database Structure:**
```javascript
// Lowcoder dedicated database
use lowcoder;
db.createUser({
  user: "lowcoder_user",
  pwd: "${LOWCODER_DB_PASSWORD}",
  roles: [
    { role: "readWrite", db: "lowcoder" },
    { role: "dbAdmin", db: "lowcoder" }
  ]
});
```

**Schema Management:**
Lowcoder manages its MongoDB schema internally. Key collections include:
- `applications` - Low-code app definitions
- `queries` - Database queries and API configurations
- `users` - Lowcoder user accounts
- `organizations` - Multi-tenant organization data
- `datasources` - External data source connections

**MongoDB Connection String Format:**
```
LOWCODER_MONGODB_URL=mongodb://lowcoder_user:${LOWCODER_DB_PASSWORD}@mongodb:27017/lowcoder?authSource=lowcoder
```

**Redis Data Organization** [Source: architecture/database-schema.md#redis-data-organization]

Redis is shared across services using key prefixes:
```
lowcoder:session:{sessionId}      # Lowcoder user sessions
lowcoder:cache:{key}              # Lowcoder application cache
```

**Redis Connection String Format:**
```
LOWCODER_REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379
```

### Security Requirements

**Lowcoder Security Configuration** [Source: architecture/coding-standards.md, previous story insights]

1. **Encryption Keys:**
   - LOWCODER_ENCRYPTION_PASSWORD: 32-character alphanumeric string for application data encryption
   - LOWCODER_ENCRYPTION_SALT: 32-character alphanumeric string for encryption salt
   - Generated via: `openssl rand -base64 32 | tr -d '=/+' | cut -c1-32`
   - Used for encrypting datasource credentials and sensitive application data

2. **Admin Credentials:**
   - LOWCODER_ADMIN_EMAIL: Valid email address for default admin account
   - LOWCODER_ADMIN_PASSWORD: Strong password (32-character alphanumeric)
   - First-time login creates default admin account
   - Users must change password on first login (documented in setup guide)

3. **Database Security:**
   - Dedicated database user (lowcoder_user) with access ONLY to lowcoder database
   - Strong password (32-character alphanumeric)
   - MongoDB connection over internal Docker network (no host exposure)

4. **Network Isolation:**
   - MongoDB and Redis accessible only on `borgstack_internal` network
   - Web UI exposed via Caddy on `borgstack_external` with HTTPS
   - Application runtime protected by HTTPS (automatic Let's Encrypt SSL)

5. **Credential Management:**
   - Passwords stored in .env file with 600 permissions
   - Strong password generation: 32-character alphanumeric via `openssl rand -base64 32`
   - Never commit .env to version control (enforced by .gitignore)

6. **HTTPS Enforcement:**
   - All HTTP requests redirected to HTTPS by Caddy
   - Let's Encrypt automatic certificate renewal
   - Secure session management via Redis

### Lowcoder Environment Variables

**Required Environment Variables** [Source: Lowcoder documentation, architecture context]

```yaml
# MongoDB Connection
LOWCODER_MONGODB_URL: mongodb://lowcoder_user:${LOWCODER_DB_PASSWORD}@mongodb:27017/lowcoder?authSource=lowcoder
LOWCODER_DB_PASSWORD: ${LOWCODER_DB_PASSWORD}  # 32-char from bootstrap, used in MongoDB connection

# Redis Connection
LOWCODER_REDIS_URL: redis://:${REDIS_PASSWORD}@redis:6379

# Service URLs (Internal)
LOWCODER_API_SERVICE_URL: http://lowcoder:3000
LOWCODER_NODE_SERVICE_URL: http://lowcoder:6060

# Admin Account (First-time setup)
LOWCODER_ADMIN_EMAIL: admin@${DOMAIN}
LOWCODER_ADMIN_PASSWORD: ${LOWCODER_ADMIN_PASSWORD}  # 32-char from bootstrap

# Encryption Keys
LOWCODER_ENCRYPTION_PASSWORD: ${LOWCODER_ENCRYPTION_PASSWORD}  # 32-char
LOWCODER_ENCRYPTION_SALT: ${LOWCODER_ENCRYPTION_SALT}  # 32-char

# Optional: External URL (for webhooks and OAuth)
LOWCODER_PUBLIC_URL: https://lowcoder.${DOMAIN}
```

### Network Configuration

**Network Isolation Requirements** [Source: architecture/coding-standards.md#network-isolation]

```yaml
# ✅ Correct - Lowcoder on both networks
lowcoder:
  networks:
    - borgstack_internal  # Access to MongoDB, Redis
    - borgstack_external  # Access from Caddy reverse proxy

# ❌ Wrong - no port exposure in production
lowcoder:
  ports:
    - "3000:3000"  # Security violation
```

**Rationale:** Defense in depth; limits attack surface. Only Caddy (reverse proxy) should expose ports 80/443.

### Docker Compose Configuration Template

**Lowcoder Service Definition** [Source: architecture/coding-standards.md patterns]

```yaml
lowcoder:
  image: lowcoderorg/lowcoder-ce:2.7.4
  container_name: lowcoder
  restart: unless-stopped
  networks:
    - borgstack_internal
    - borgstack_external
  volumes:
    - borgstack_lowcoder_stacks:/lowcoder-stacks
  environment:
    - LOWCODER_MONGODB_URL=mongodb://lowcoder_user:${LOWCODER_DB_PASSWORD}@mongodb:27017/lowcoder?authSource=lowcoder
    - LOWCODER_REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379
    - LOWCODER_API_SERVICE_URL=http://lowcoder:3000
    - LOWCODER_NODE_SERVICE_URL=http://lowcoder:6060
    - LOWCODER_ADMIN_EMAIL=${LOWCODER_ADMIN_EMAIL}
    - LOWCODER_ADMIN_PASSWORD=${LOWCODER_ADMIN_PASSWORD}
    - LOWCODER_ENCRYPTION_PASSWORD=${LOWCODER_ENCRYPTION_PASSWORD}
    - LOWCODER_ENCRYPTION_SALT=${LOWCODER_ENCRYPTION_SALT}
    - LOWCODER_PUBLIC_URL=https://lowcoder.${DOMAIN}
  depends_on:
    mongodb:
      condition: service_healthy
    redis:
      condition: service_healthy
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
    interval: 30s
    timeout: 10s
    retries: 5
    start_period: 60s
```

### Volume Configuration

**Volume Naming Convention** [Source: architecture/coding-standards.md#volume-naming-convention]

```yaml
volumes:
  borgstack_lowcoder_stacks:
    # Application definitions, custom components, query configurations
```

**Rationale:** Prefix all Docker volumes with `borgstack_` for easy identification and prevents conflicts with other Docker stacks on same host.

### Health Check Configuration

**Health Check Strategy** [Source: architecture/coding-standards.md#health-check-requirements]

```yaml
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
  interval: 30s      # Check every 30 seconds
  timeout: 10s       # Timeout after 10 seconds
  retries: 5         # 5 failures before unhealthy
  start_period: 60s  # Allow 60s for Spring Boot + Node.js initialization
```

**Start Period Rationale:**
- Spring Boot backend initialization: ~30-40s
- Node.js service initialization: ~10-15s
- MongoDB connection establishment: ~5s
- Redis connection establishment: ~2s
- Total: ~60s buffer for safe startup

### Integration Patterns

**Lowcoder ↔ n8n Integration** [Source: Previous story patterns, architecture/components.md]

**Pattern 1: Webhook Trigger (Lowcoder → n8n)**
- Lowcoder application triggers n8n workflow via webhook
- Use case: Form submission in Lowcoder app triggers automation
- Configuration: API query in Lowcoder pointing to n8n webhook URL

**Pattern 2: API Query (Lowcoder → n8n)**
- Lowcoder queries n8n API endpoints for data
- Use case: Display workflow execution results in Lowcoder dashboard
- Configuration: REST API datasource in Lowcoder

**Pattern 3: Database Sharing (Optional)**
- Lowcoder can query PostgreSQL databases (n8n_db, chatwoot_db, etc.)
- Use case: Build admin dashboards for viewing n8n workflows, Chatwoot conversations
- Configuration: PostgreSQL datasource in Lowcoder pointing to borgstack PostgreSQL

### Testing Requirements

**Deployment Validation Tests** [Source: architecture/testing-strategy.md, previous story patterns]

Create `tests/deployment/verify-lowcoder.sh` with these validations:

1. **Service Configuration Tests:**
   - Image version: `lowcoderorg/lowcoder-ce:2.7.4`
   - Network connections: `borgstack_internal`, `borgstack_external`
   - Volume mounts: `borgstack_lowcoder_stacks`
   - No port exposure to host (security requirement)

2. **Environment Variable Tests:**
   - LOWCODER_MONGODB_URL format validation
   - LOWCODER_REDIS_URL format validation
   - Admin credentials configured
   - Encryption keys configured (32-char validation)

3. **Dependency Tests:**
   - Depends on MongoDB (condition: service_healthy)
   - Depends on Redis (condition: service_healthy)

4. **Health Check Tests:**
   - Health check command configured
   - Proper intervals and retries
   - Start period set to 60s

5. **Integration Tests (Deferred to Story 6.1):**
   - Note: Full integration testing is deferred to Story 6.1
   - Story 3.2 focuses on deployment validation only
   - Integration tests to validate:
     - Admin login functional
     - Application creation working
     - Data source connection to PostgreSQL successful
     - Basic application deployment tested

**CI Workflow Integration** [Source: .github/workflows/ci.yml patterns]

Add `validate-lowcoder` job:
```yaml
validate-lowcoder:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - name: Validate Lowcoder configuration
      run: |
        # Test 1: Verify image version
        grep -q "lowcoderorg/lowcoder-ce:2.7.4" docker-compose.yml

        # Test 2: Verify networks
        docker compose config | grep -A5 "lowcoder:" | grep "borgstack_internal"
        docker compose config | grep -A5 "lowcoder:" | grep "borgstack_external"

        # Test 3: Verify no port exposure
        ! docker compose config | grep -A20 "lowcoder:" | grep "ports:"

        # Test 4: Verify environment variables
        grep -q "LOWCODER_MONGODB_URL" docker-compose.yml
        grep -q "LOWCODER_REDIS_URL" docker-compose.yml

        # Test 5: Verify dependencies
        docker compose config | grep -A10 "lowcoder:" | grep "mongodb"
        docker compose config | grep -A10 "lowcoder:" | grep "redis"

        # Test 6: Verify documentation exists
        test -f config/lowcoder/README.md
        test -f tests/deployment/verify-lowcoder.sh
        test -x tests/deployment/verify-lowcoder.sh
```

### Backup Strategy

**Lowcoder Data Backup** [Source: architecture/components.md#duplicati-backup-system]

**Backup Sources:**
1. MongoDB `lowcoder` database (application definitions, users, datasources)
2. Docker volume `borgstack_lowcoder_stacks` (custom components, assets)

**Backup Configuration (Duplicati):**
- Frequency: Daily incremental, weekly full backup
- Retention: 30 daily backups, 12 weekly backups
- Encryption: AES-256 encryption with passphrase
- Destination: External storage (S3, B2, FTP, etc.)

**Restore Procedure:**
1. Stop Lowcoder container
2. Restore MongoDB lowcoder database via mongodump/mongorestore
3. Restore Docker volume via Duplicati restore job
4. Start Lowcoder container
5. Verify application list and datasource connections

### Common Integration Use Cases

**Use Case 1: Customer Dashboard**
- Build Lowcoder app to display Chatwoot conversations
- Connect to PostgreSQL `chatwoot_db` as datasource
- Query conversations, contacts, agents tables
- Display real-time customer service metrics

**Use Case 2: Workflow Management Interface**
- Build Lowcoder app to manage n8n workflows
- Connect to PostgreSQL `n8n_db` as datasource
- Query workflow_entity, execution_entity tables
- Trigger workflows via n8n API queries

**Use Case 3: WhatsApp Campaign Builder**
- Build Lowcoder app for WhatsApp campaign creation
- Use API query to Evolution API for instance management
- Trigger n8n workflow via webhook to send bulk messages
- Store campaign data in custom PostgreSQL database

**Use Case 4: CMS Admin Panel**
- Build Lowcoder app for Directus content management
- Connect to Directus GraphQL API as datasource
- CRUD operations on Directus collections
- Custom workflow triggers via n8n webhooks

### Troubleshooting Guide (for config/lowcoder/README.md)

**Common Issues and Solutions:**

1. **MongoDB Connection Failed**
   - Verify LOWCODER_MONGODB_URL format
   - Check LOWCODER_DB_PASSWORD in .env
   - Verify lowcoder_user exists in MongoDB
   - Test: `docker compose exec mongodb mongosh -u lowcoder_user -p "${LOWCODER_DB_PASSWORD}" --authenticationDatabase lowcoder lowcoder`

2. **Redis Connection Failed**
   - Verify LOWCODER_REDIS_URL format
   - Check REDIS_PASSWORD in .env
   - Test: `docker compose exec redis redis-cli -a "${REDIS_PASSWORD}" PING`

3. **Admin Login Not Working**
   - Verify LOWCODER_ADMIN_EMAIL and LOWCODER_ADMIN_PASSWORD set
   - Check logs: `docker compose logs lowcoder | grep -i admin`
   - Reset admin password via MongoDB (documented in README)

4. **Application Not Saving**
   - Verify borgstack_lowcoder_stacks volume mounted
   - Check volume permissions: `docker compose exec lowcoder ls -la /lowcoder-stacks`
   - Check MongoDB connection (applications stored in MongoDB)

5. **Datasource Connection Failed**
   - For PostgreSQL: Ensure service on borgstack_internal network
   - For external APIs: Check firewall rules and network connectivity
   - Test connection via Lowcoder datasource test button

6. **Health Check Failing**
   - Check if Spring Boot started: `docker compose logs lowcoder | grep "Started"`
   - Check Node.js service: `docker compose logs lowcoder | grep "Node service"`
   - Increase start_period if initialization takes longer

### Testing

**Test File Location:** `tests/deployment/verify-lowcoder.sh`

**Test Standards:** [Source: architecture/testing-strategy.md]
- Deployment validation focus (no unit tests for pre-built images)
- Configuration verification via docker compose config parsing
- Environment variable validation
- Dependency and health check validation

**Testing Frameworks:**
- Bash script with exit codes (0 = pass, 1 = fail)
- CI integration via GitHub Actions
- Each test outputs clear PASS/FAIL status

**Specific Testing Requirements for Story 3.2:**
1. Validate Lowcoder image version (exact match: lowcoderorg/lowcoder-ce:2.7.4 - no wildcards)
2. Validate network isolation (borgstack_internal + borgstack_external, no port exposure)
3. Validate volume configuration (borgstack_lowcoder_stacks mounted correctly)
4. Validate environment variables (MongoDB URL, Redis URL, admin credentials, encryption keys)
5. Validate dependencies (mongodb and redis with service_healthy condition)
6. Validate health check configuration (command, intervals, retries, start_period)
7. Validate Caddy reverse proxy configuration exists
8. Validate MongoDB database and user configuration exists
9. Validate documentation files exist (config/lowcoder/README.md)
10. Validate test script exists and is executable

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-03 | 1.0 | Initial story creation with comprehensive architecture context | Bob (Scrum Master) |
| 2025-10-03 | 1.1 | Quality improvements: Added LOWCODER_DB_PASSWORD to env vars, clarified AC 4 mapping, improved task instructions, added integration testing note | Sarah (Product Owner) |

---

## Dev Agent Record

_This section will be populated by the development agent during implementation._

---

## QA Results

_This section will be populated by the QA agent after story completion._
